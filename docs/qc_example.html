<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MHKiT Quality Control Module &mdash; MHKiT v0.8.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/mhkit.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=b3dab91b"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            MHKiT
          </a>
              <div class="version">
                v0.8.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">MHKiT-Python Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="matlab_installation.html">MHKiT-MATLAB Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="module.html">Module Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="webinars.html">Webinars</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="citeus.html">Cite Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Online Forum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MHKiT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">MHKiT Quality Control Module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/qc_example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="MHKiT-Quality-Control-Module">
<h1>MHKiT Quality Control Module<a class="headerlink" href="#MHKiT-Quality-Control-Module" title="Link to this heading"></a></h1>
<p>The following example runs a simple quality control analysis on wave elevation data using the <a class="reference external" href="https://mhkit-software.github.io/MHKiT/mhkit-python/api.qc.html">MHKiT QC module</a>. The data file used in this example is stored in the <a class="reference external" href="https://github.com/MHKiT-Software/MHKiT-Python/tree/master/examples/data">\MHKiT\examples\data</a> directory.</p>
<p>Start by importing the necessary Python packages and MHKiT modules.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import pandas as pd
from mhkit import qc, utils
</pre></div>
</div>
</div>
<section id="Load-Data">
<h2>Load Data<a class="headerlink" href="#Load-Data" title="Link to this heading"></a></h2>
<p>The wave elevation data used in this example includes several issues, including timestamps that are out of order, corrupt data with values of -999, data outside the expected range, and stagnant data.</p>
<p>The data is loaded into a pandas DataFrame using the pandas method <code class="docutils literal notranslate"><span class="pre">read_csv</span></code>. The first 5 rows of data are shown below, along with a plot.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Load data from the csv file into a DataFrame
data = pd.read_csv(&quot;data/qc/wave_elevation_data.csv&quot;, index_col=&quot;Time&quot;)

# Plot the data
data.plot(figsize=(15, 5), ylim=(-60, 60))

# Print the first 5 rows of data
print(data.head())
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
        probe1  probe2  probe3
Time
10.000   24.48   28.27     1.3
10.002   34.48   40.27    -8.7
10.004   30.48   38.27   -13.7
10.006   12.48   24.27   -32.7
10.008   13.48   22.27   -21.7
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qc_example_4_1.png" src="_images/qc_example_4_1.png" />
</div>
</div>
<p>The data is indexed by time in seconds. To use the quality control functions, the data must be indexed by datetime. The index can be converted to datetime using the following utility function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Convert the index to datetime
data.index = utils.index_to_datetime(data.index, origin=&quot;2019-05-20&quot;)

# Print the first 5 rows of data
print(data.head())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                         probe1  probe2  probe3
Time
2019-05-20 00:00:10.000   24.48   28.27     1.3
2019-05-20 00:00:10.002   34.48   40.27    -8.7
2019-05-20 00:00:10.004   30.48   38.27   -13.7
2019-05-20 00:00:10.006   12.48   24.27   -32.7
2019-05-20 00:00:10.008   13.48   22.27   -21.7
</pre></div></div>
</div>
</section>
<section id="Quality-control-tests">
<h2>Quality control tests<a class="headerlink" href="#Quality-control-tests" title="Link to this heading"></a></h2>
<p>The following quality control tests are used to identify timestamp issues, corrupt data, data outside the expected range, and stagnant data.</p>
<p>Each quality control tests results in the following information:</p>
<ul class="simple">
<li><p>Cleaned data, which is a DataFrame that has <em>NaN</em> in place of data that did not pass the quality control test</p></li>
<li><p>Boolean mask, which is a DataFrame with True/False that indicates if each data point passed the quality control test</p></li>
<li><p>Summary of the quality control test results, the summary includes the variable name (which is blank for timestamp issues), the start and end time of the test failure, and an error flag for each test failure</p></li>
</ul>
<section id="Check-timestamp">
<h3>Check timestamp<a class="headerlink" href="#Check-timestamp" title="Link to this heading"></a></h3>
<p>Quality control analysis generally starts by checking the timestamp index of the data.</p>
<p>The following test checks to see if 1) the data contains duplicate timestamps, 2) timestamps are not monotonically increasing, and 3) timestamps occur at irregular intervals (an interval of 0.002s is expected for this data).</p>
<p>If duplicate timestamps are found, the resulting DataFrames (cleaned data and mask) keep the first occurrence. If timestamps are not monotonic, the timestamps in the resulting DataFrames are reordered.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Define expected frequency of the data, in seconds
frequency = 0.002

# Run the timestamp quality control test
results = qc.check_timestamp(data, frequency)
</pre></div>
</div>
</div>
<p>The cleaned data, boolean mask, and test results summary are shown below. The summary is transposed (using .T) so that it is easier to read.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Plot cleaned data
results[&quot;cleaned_data&quot;].plot(figsize=(15, 5), ylim=(-60, 60))

# Print the first 5 rows of the cleaned data
print(results[&quot;cleaned_data&quot;].head())
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                         probe1  probe2  probe3
2019-05-20 00:00:10.000   24.48   28.27     1.3
2019-05-20 00:00:10.002   34.48   40.27    -8.7
2019-05-20 00:00:10.004   30.48   38.27   -13.7
2019-05-20 00:00:10.006   12.48   24.27   -32.7
2019-05-20 00:00:10.008   13.48   22.27   -21.7
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qc_example_11_1.png" src="_images/qc_example_11_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Print the first 5 rows of the mask
print(results[&quot;mask&quot;].head())
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                         probe1  probe2  probe3
2019-05-20 00:00:10.000    True    True    True
2019-05-20 00:00:10.002    True    True    True
2019-05-20 00:00:10.004    True    True    True
2019-05-20 00:00:10.006    True    True    True
2019-05-20 00:00:10.008    True    True    True
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Print the test results summary
# The summary is transposed (using .T) so that it is easier to read.
print(results[&quot;test_results&quot;].T)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                                        0                           1  \
Variable Name
Start Time     2019-05-20 00:00:10.230000  2019-05-20 00:00:10.340000
End Time       2019-05-20 00:00:10.230000  2019-05-20 00:00:10.340000
Timesteps                               1                           1
Error Flag         Nonmonotonic timestamp         Duplicate timestamp

                                        2
Variable Name
Start Time     2019-05-20 00:00:10.042000
End Time       2019-05-20 00:00:10.044000
Timesteps                               2
Error Flag              Missing timestamp
</pre></div></div>
</div>
</section>
<section id="Check-for-corrupt-data">
<h3>Check for corrupt data<a class="headerlink" href="#Check-for-corrupt-data" title="Link to this heading"></a></h3>
<p>In the following quality control tests, the cleaned data from the previous test is used as input to the subsequent test. For each quality control test, a plot of the cleaned data is shown along with the test results summary.</p>
<p>Note, that if you want to run a series of quality control tests before extracting the cumulative cleaned data, boolean mask, and summary, we recommend using Pecos directly with the object-oriented approach, see <a class="reference external" href="https://pecos.readthedocs.io/">https://pecos.readthedocs.io/</a> for more details.</p>
<p>The quality control test below checks for corrupt data, indicated by a value of -999.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Define corrupt values
corrupt_values = [-999]

# Run the corrupt data quality control test
results = qc.check_corrupt(results[&quot;cleaned_data&quot;], corrupt_values)

# Plot cleaned data
results[&quot;cleaned_data&quot;].plot(figsize=(15, 5), ylim=(-60, 60))

# Print test results summary
print(results[&quot;test_results&quot;].T)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                                        0                           1
Variable Name                      probe1                      probe3
Start Time     2019-05-20 00:00:10.110000  2019-05-20 00:00:10.834000
End Time       2019-05-20 00:00:10.134000  2019-05-20 00:00:10.848000
Timesteps                              13                           8
Error Flag                   Corrupt data                Corrupt data
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qc_example_15_1.png" src="_images/qc_example_15_1.png" />
</div>
</div>
</section>
<section id="Check-for-data-outside-the-expected-range">
<h3>Check for data outside the expected range<a class="headerlink" href="#Check-for-data-outside-the-expected-range" title="Link to this heading"></a></h3>
<p>The next quality control test checks for data that is greater than 50 or less than -50. Note that expected range tests can also be used to compare measured values to a model, or analyze the expected relationships between data columns.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Define expected lower and upper bound ([lower bound, upper bound])
expected_bounds = [-50, 50]

# Run expected range quality control test
results = qc.check_range(results[&quot;cleaned_data&quot;], expected_bounds)

# Plot cleaned data
results[&quot;cleaned_data&quot;].plot(figsize=(15, 5), ylim=(-60, 60))

# Print test results summary
print(results[&quot;test_results&quot;].T)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                                        0                           1  \
Variable Name                      probe3                      probe3
Start Time     2019-05-20 00:00:10.240000  2019-05-20 00:00:10.468000
End Time       2019-05-20 00:00:10.240000  2019-05-20 00:00:10.468000
Timesteps                               1                           1
Error Flag        Data &lt; lower bound, -50     Data &lt; lower bound, -50

                                        2
Variable Name                      probe3
Start Time     2019-05-20 00:00:10.716000
End Time       2019-05-20 00:00:10.716000
Timesteps                               1
Error Flag         Data &gt; upper bound, 50
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qc_example_17_1.png" src="_images/qc_example_17_1.png" />
</div>
</div>
</section>
<section id="Check-for-stagnant-data">
<h3>Check for stagnant data<a class="headerlink" href="#Check-for-stagnant-data" title="Link to this heading"></a></h3>
<p>The final quality control test checks for stagnant data by looking for data that changes by less than 0.001 within a 0.02 second moving window.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Define expected lower bound (no upper bound is specified in this example)
expected_bound = [0.001, None]

# Define the moving window, in seconds
window = 0.02

# Run the delta quality control test
results = qc.check_delta(results[&quot;cleaned_data&quot;], expected_bound, window)

# Plot cleaned data
results[&quot;cleaned_data&quot;].plot(figsize=(15, 5), ylim=(-60, 60))

# Print test results summary
print(results[&quot;test_results&quot;].T)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
                                        0
Variable Name                      probe2
Start Time     2019-05-20 00:00:10.400000
End Time       2019-05-20 00:00:10.544000
Timesteps                              73
Error Flag     Delta &lt; lower bound, 0.001
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/qc_example_19_1.png" src="_images/qc_example_19_1.png" />
</div>
</div>
</section>
</section>
<section id="Cleaned-Data">
<h2>Cleaned Data<a class="headerlink" href="#Cleaned-Data" title="Link to this heading"></a></h2>
<p>The cleaned data can be used directly in MHKiT analysis, or the missing values can be replaced using various methods before analysis is run. Data replacement strategies are generally defined on a case by case basis. Pandas includes methods to interpolate, replace, and fill missing values.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Extract final cleaned data for MHKiT analysis
cleaned_data = results[&quot;cleaned_data&quot;]
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, National Renewable Energy Laboratory, Pacific Northwest National Laboratory, and Sandia National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164358105-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-164358105-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>