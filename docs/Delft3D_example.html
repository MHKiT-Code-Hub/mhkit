<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Delft3D IO Module &mdash; MHKiT v0.8.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/mhkit.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=b3dab91b"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            MHKiT
          </a>
              <div class="version">
                v0.8.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">MHKiT-Python Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="matlab_installation.html">MHKiT-MATLAB Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="module.html">Module Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="webinars.html">Webinars</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="citeus.html">Cite Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Online Forum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MHKiT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Delft3D IO Module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Delft3D_example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Delft3D-IO-Module">
<h1>Delft3D IO Module<a class="headerlink" href="#Delft3D-IO-Module" title="Link to this heading"></a></h1>
<p>The following example will familiarize the user with using the Delft3D (d3d) toolbox in MHKiT-Python. <code class="docutils literal notranslate"><span class="pre">d3d</span></code> can be used to plot the data from a NetCDF output from Delft3D <a class="reference external" href="https://github.com/MHKiT-Software/MHKiT-Python">SNL-D3D-CEC-FM</a>. The example will walk through a flume case with a turbine. The flume is 18 m long, 4 m wide and 2m deep with the turbine placed at 6 m along the length and 3 m along the width. The turbine used for this simulation has a circular cross-section with a diameter
of 0.7m, a thrust coefficient of 0.72, and a power coefficient of 0.45. The simulation was run with 5 depth layers and 5-time intervals over 4 min.</p>
<p>This example will show how to create a centerline plot at a desired depth for different variables outputs of Delft3D using matplotlib. It will also show how to make a contour plot of a given plane or depth for the variable output by Delft3D and how to use those variables to calculate turbulence intensity. This module can be helpful to visualize the wake of a turbine and help predict how a turbine will affect the surrounding area.</p>
<p>Start by importing the necessary python packages and MHKiT module.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from os.path import abspath, dirname, join, normpath, relpath
from mhkit.river.io import d3d
from math import isclose
import scipy.interpolate as interp
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import netCDF4

plt.rcParams.update({&quot;font.size&quot;: 15})  # Set font size of plots title and labels
</pre></div>
</div>
</div>
<section id="Loading-Data-from-Delft3D-as-a-NetCDF">
<h2>Loading Data from Delft3D as a NetCDF<a class="headerlink" href="#Loading-Data-from-Delft3D-as-a-NetCDF" title="Link to this heading"></a></h2>
<p>A NetCDF file has been saved in the <a class="reference external" href="https://github.com/browniea/MHKiT-Python/tree/d3d/examples/data/river/d3d">\MHKiT-Pythonexamplesdatariverd3d</a> directory of a simple flume case with a turbine for reference data. Here we are inputting strings for the file path <code class="docutils literal notranslate"><span class="pre">datadir</span></code>, and file name <code class="docutils literal notranslate"><span class="pre">filename</span></code>, so the NetCDF file can be saved as a NetCDF object using the python pack <code class="docutils literal notranslate"><span class="pre">netCDF4</span></code> under the variable <code class="docutils literal notranslate"><span class="pre">d3d_data</span></code>.</p>
<p>There are many variables saved in the NetCDF object <code class="docutils literal notranslate"><span class="pre">d3d_data</span></code>. The function <code class="docutils literal notranslate"><span class="pre">d3d_data.variables.keys()</span></code> returns a dictionary of the available data. Here we look at the dictionary keys output to see all the variables.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Downloading Data
datadir = normpath(join(relpath(join(&quot;data&quot;, &quot;river&quot;, &quot;d3d&quot;))))
filename = &quot;turbineTest_map.nc&quot;
d3d_data = netCDF4.Dataset(join(datadir, filename))

# Printing variable and description
for var in d3d_data.variables.keys():
    try:
        d3d_data[var].long_name
    except:
        print(f&#39;&quot;{var}&quot;&#39;)
    else:
        print(f&#39;&quot;{var}&quot;: {d3d_data[var].long_name}&#39;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#34;mesh2d_enc_x&#34;: x-coordinate
&#34;mesh2d_enc_y&#34;: y-coordinate
&#34;mesh2d_enc_node_count&#34;: count of coordinates in each instance geometry
&#34;mesh2d_enc_part_node_count&#34;: count of nodes in each geometry part
&#34;mesh2d_enc_interior_ring&#34;: type of each geometry part
&#34;mesh2d_enclosure_container&#34;
&#34;Mesh2D&#34;
&#34;NetNode_x&#34;: x-coordinate
&#34;NetNode_y&#34;: y-coordinate
&#34;projected_coordinate_system&#34;
&#34;NetNode_z&#34;: bed level at net nodes (flow element corners)
&#34;NetLink&#34;: link between two netnodes
&#34;NetLinkType&#34;: type of netlink
&#34;NetElemNode&#34;: mapping from net cell to net nodes (counterclockwise)
&#34;NetElemLink&#34;: mapping from net cell to its net links (counterclockwise)
&#34;NetLinkContour_x&#34;: list of x-contour points of momentum control volume surrounding each net/flow link
&#34;NetLinkContour_y&#34;: list of y-contour points of momentum control volume surrounding each net/flow link
&#34;NetLink_xu&#34;: x-coordinate of net link center (velocity point)
&#34;NetLink_yu&#34;: y-coordinate of net link center (velocity point)
&#34;BndLink&#34;: netlinks that compose the net boundary
&#34;FlowElem_xcc&#34;: x-coordinate of flow element circumcenter
&#34;FlowElem_ycc&#34;: y-coordinate of flow element circumcenter
&#34;FlowElem_zcc&#34;: bed level of flow element
&#34;FlowElem_bac&#34;: flow element area
&#34;FlowElem_xzw&#34;: x-coordinate of flow element center of mass
&#34;FlowElem_yzw&#34;: y-coordinate of flow element center of mass
&#34;FlowElemContour_x&#34;: list of x-coordinates forming flow element
&#34;FlowElemContour_y&#34;: list of y-coordinates forming flow element
&#34;FlowElem_bl&#34;: Initial bed level at flow element circumcenter
&#34;ElemLink&#34;: flow nodes between/next to which link between two netnodes lies
&#34;FlowLink&#34;: link/interface between two flow elements
&#34;FlowLinkType&#34;: type of flowlink
&#34;FlowLink_xu&#34;: x-coordinate of flow link center (velocity point)
&#34;FlowLink_yu&#34;: y-coordinate of flow link center (velocity point)
&#34;FlowLink_lonu&#34;: longitude
&#34;FlowLink_latu&#34;: latitude
&#34;time&#34;
&#34;LayCoord_cc&#34;: sigma layer coordinate at flow element center
&#34;LayCoord_w&#34;: sigma layer coordinate at vertical interface
&#34;timestep&#34;
&#34;s1&#34;: water level
&#34;waterdepth&#34;: water depth
&#34;unorm&#34;: normal component of sea_water_speed
&#34;ucz&#34;: upward velocity on flow element center
&#34;ucxa&#34;: depth-averaged velocity on flow element center, x-component
&#34;ucya&#34;: depth-averaged velocity on flow element center, y-component
&#34;ww1&#34;: upward velocity on vertical interface
&#34;ucx&#34;: velocity on flow element center, x-component
&#34;ucy&#34;: velocity on flow element center, y-component
&#34;turkin1&#34;: turbulent kinetic energy
&#34;vicwwu&#34;: turbulent vertical eddy viscosity
&#34;tureps1&#34;: turbulent energy dissipation
</pre></div></div>
</div>
</section>
<section id="Seconds-Run-and-Time-Index">
<h2>Seconds Run and Time Index<a class="headerlink" href="#Seconds-Run-and-Time-Index" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">'time_index'</span></code> can be used to pull data from different instances in time. For the example data included there are 5-time steps meaning we have indexes in the range 0 and to 4. Each time index has an associated <code class="docutils literal notranslate"><span class="pre">'seconds_run'</span></code> that quantifies the number of seconds that passed from the start of the simulation. To get all of the <code class="docutils literal notranslate"><span class="pre">'seconds_run'</span></code> for a data set use the function <code class="docutils literal notranslate"><span class="pre">get_all_time</span></code> the output is an array of all the <code class="docutils literal notranslate"><span class="pre">'seconds_run'</span></code> for the input data set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>time = d3d.get_all_time(d3d_data)
print(time)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[  0.  60. 120. 180. 240.]
</pre></div></div>
</div>
<p>To convert from a <code class="docutils literal notranslate"><span class="pre">'seconds_run'</span></code> to a <code class="docutils literal notranslate"><span class="pre">'time_index'</span></code> or vice versa. The inputs are a netcdf data set, then a <code class="docutils literal notranslate"><span class="pre">'time_index'</span></code>. This example shows what happens if you input a <code class="docutils literal notranslate"><span class="pre">'seconds_run'</span></code> that is close to but not exactly a <code class="docutils literal notranslate"><span class="pre">'seconds_run'</span></code> associated with a <code class="docutils literal notranslate"><span class="pre">'time_idex'</span></code>. The function will throw a warning and return the closest time index.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>seconds_run = 62
time_index = d3d._convert_time(d3d_data, seconds_run=seconds_run)
print(time_index)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
&lt;ipython-input-4-f8084d84fcf8&gt;:2: UserWarning: Warning: seconds_run not found. Closest time stampfound {times[idx]}
  time_index=d3d._convert_time(d3d_data,seconds_run=seconds_run)
</pre></div></div>
</div>
</section>
<section id="Dataframe-from-NetCDF">
<h2>Dataframe from NetCDF<a class="headerlink" href="#Dataframe-from-NetCDF" title="Link to this heading"></a></h2>
<p>For this example we will create a DataFrame from the D3d NetCDF object using the variable <code class="docutils literal notranslate"><span class="pre">'ucx'</span></code>, the velocity in the x-direction (see available data in previous block output). MHKiT’s <code class="docutils literal notranslate"><span class="pre">d3d</span></code> function <code class="docutils literal notranslate"><span class="pre">get_all_data_points</span></code> will pull all the raw data from the NetCDF file for the specified variable at a specific time index in a dataframe <code class="docutils literal notranslate"><span class="pre">var_data_df</span></code>. The <code class="docutils literal notranslate"><span class="pre">time_index</span></code> can be used to pull data from a different instances in time (the last valid time_index, <code class="docutils literal notranslate"><span class="pre">time_index</span></code>=-1, is the
default setting). If an integer outside of the valid range is entered the code will output an error with the max valid output listed. The output data from <code class="docutils literal notranslate"><span class="pre">get_all_data_points</span></code> will be the position (x, y, waterdepth) in meters, the value of vairable in meters per second and the run time of the simulation in seconds or <code class="docutils literal notranslate"><span class="pre">'x'</span></code>, <code class="docutils literal notranslate"><span class="pre">'y'</span></code>, <code class="docutils literal notranslate"><span class="pre">'waterdepth'</span></code>, <code class="docutils literal notranslate"><span class="pre">'waterlevel'</span></code>, ‘<code class="docutils literal notranslate"><span class="pre">ucx</span></code>’, and <code class="docutils literal notranslate"><span class="pre">'time'</span></code>. The time run in simulation varies based on the ‘time_step’.</p>
<p>The limits <code class="docutils literal notranslate"><span class="pre">max_plot_vel</span></code> and <code class="docutils literal notranslate"><span class="pre">min_plot_vel</span></code> are defined to bound the plots of the variable’s data in the next 3 example plots.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Getting variable data
variable = &quot;ucx&quot;
var_data_df = d3d.get_all_data_points(d3d_data, variable, time_index=4)
print(var_data_df)

# Setting plot limits
max_plot_vel = 1.25
min_plot_vel = 0.5
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
           x      y  waterdepth  waterlevel       ucx   time
0      0.125  1.125    0.199485   -0.005154  0.717881  240.0
1      0.375  1.125    0.200008    0.000081  0.689645  240.0
2      0.125  1.375    0.199485   -0.005154  0.717881  240.0
3      0.625  1.125    0.200056    0.000559  0.694164  240.0
4      0.375  1.375    0.200008    0.000081  0.689645  240.0
...      ...    ...         ...         ...       ...    ...
5755  17.625  4.625    1.794649   -0.005946  1.245117  240.0
5756  17.375  4.875    1.794848   -0.005724  1.222989  240.0
5757  17.875  4.625    1.799824   -0.000196  1.255866  240.0
5758  17.625  4.875    1.794638   -0.005958  1.245292  240.0
5759  17.875  4.875    1.799828   -0.000191  1.256067  240.0

[5760 rows x 6 columns]
</pre></div></div>
</div>
</section>
<section id="Plotting-a-Line-Plot-Between-Two-Points">
<h2>Plotting a Line Plot Between Two Points<a class="headerlink" href="#Plotting-a-Line-Plot-Between-Two-Points" title="Link to this heading"></a></h2>
<p>To view the maximum wake effect of the turbine we can plot a velocity down the centerline of the flume. To do this we will create an array between two points down the center of the flume. We will then interpolate the grided data results onto our centerline array. Since the flume is retangular the centerline points are found by taking the average of the maximum and minimum value for the width, <code class="docutils literal notranslate"><span class="pre">y</span></code>, and the <code class="docutils literal notranslate"><span class="pre">waterdepth</span></code>, of the flume. We will then input one array, <code class="docutils literal notranslate"><span class="pre">x</span></code>, and two points, <code class="docutils literal notranslate"><span class="pre">y</span></code>
and <code class="docutils literal notranslate"><span class="pre">waterdepth</span></code> into the function <code class="docutils literal notranslate"><span class="pre">create_points</span></code> to create our centerline array to interpolate over. The function <code class="docutils literal notranslate"><span class="pre">create_points</span></code> will then output a dataframe, <code class="docutils literal notranslate"><span class="pre">cline_points</span></code>, with keys <code class="docutils literal notranslate"><span class="pre">'x'</span></code>, <code class="docutils literal notranslate"><span class="pre">'y'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'waterdepth'</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Use rectangular grid min and max to find flume centerline
xmin = var_data_df.x.max()
xmax = var_data_df.x.min()

ymin = var_data_df.y.max()
ymax = var_data_df.y.min()

waterdepth_min = var_data_df.waterdepth.max()
waterdepth_max = var_data_df.waterdepth.min()

# Creating one array and 2 points
x = np.linspace(xmin, xmax)
y = np.mean([ymin, ymax])
waterdepth = np.mean([waterdepth_min, waterdepth_max])

# Creating an array of points
cline_points = d3d.create_points(x, y, waterdepth)
cline_points.head()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>waterdepth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17.875000</td>
      <td>3.0</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17.512755</td>
      <td>3.0</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>2</th>
      <td>17.150510</td>
      <td>3.0</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>3</th>
      <td>16.788265</td>
      <td>3.0</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16.426020</td>
      <td>3.0</td>
      <td>1.000931</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Next the variable <code class="docutils literal notranslate"><span class="pre">ucx</span></code> is interpolated onto the created <code class="docutils literal notranslate"><span class="pre">cline_points</span></code> using scipy interp function and saved as <code class="docutils literal notranslate"><span class="pre">cline_variable</span></code>. The results are then plotted for velocity in the x direction, <code class="docutils literal notranslate"><span class="pre">ucx</span></code>, along the length of the flume, <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Interpolate raw data onto the centerline
cline_variable = interp.griddata(
    var_data_df[[&quot;x&quot;, &quot;y&quot;, &quot;waterdepth&quot;]],
    var_data_df[variable],
    cline_points[[&quot;x&quot;, &quot;y&quot;, &quot;waterdepth&quot;]],
)

# Plotting
plt.figure(figsize=(12, 5))
plt.plot(x, cline_variable)

plt.grid()
plt.xlabel(&quot;x (m)&quot;)
plt.ylabel(&quot;$u_x$ [m/s]&quot;)
plt.title(f&quot;Centerline Velocity at: {var_data_df.time[1]} s&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Centerline Velocity at: 240.0 s&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Delft3D_example_13_1.png" src="_images/Delft3D_example_13_1.png" />
</div>
</div>
</section>
<section id="Contour-Plot-for-a-Given-Sigma-Layer">
<h2>Contour Plot for a Given Sigma Layer<a class="headerlink" href="#Contour-Plot-for-a-Given-Sigma-Layer" title="Link to this heading"></a></h2>
<p>Sometimes it is useful to plot only the raw data of a given layer. Using <code class="docutils literal notranslate"><span class="pre">get_layer_data</span></code> a single layer of raw data will be retrieved from the NetCDF object. The <code class="docutils literal notranslate"><span class="pre">d3d</span></code> function ,<code class="docutils literal notranslate"><span class="pre">get_layer_data</span></code> takes 3 inputs, the NetCDF object (<code class="docutils literal notranslate"><span class="pre">d3d_data</span></code>), a variable name as a string (<code class="docutils literal notranslate"><span class="pre">variable</span></code>), and the layer to retrieve (<code class="docutils literal notranslate"><span class="pre">layer</span></code>) as an integer. The variable is set to the velocity in the x direction, <code class="docutils literal notranslate"><span class="pre">'ucx'</span></code>, and the layer of data to plot as 2. Since there are 5 sigma layers in this example
layer 2 is approximately the middle layer. <code class="docutils literal notranslate"><span class="pre">layer</span></code> works as an index that begins at begins at 0 and ends at 4. The <code class="docutils literal notranslate"><span class="pre">get_layer_data</span></code> then outputs a dataframe <code class="docutils literal notranslate"><span class="pre">layer_data</span></code> with the keys <code class="docutils literal notranslate"><span class="pre">'x'</span></code>, <code class="docutils literal notranslate"><span class="pre">'y'</span></code>, <code class="docutils literal notranslate"><span class="pre">'waterdepth'</span></code>, <code class="docutils literal notranslate"><span class="pre">'waterlevel'</span></code>, <code class="docutils literal notranslate"><span class="pre">'v'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'time'</span></code> as the length, width, waterdepth, value, and run time of simulation of the specified variable in this case velocity in the x direction, ‘ucx’.</p>
<p>To plot the data the maximum and minimum, <code class="docutils literal notranslate"><span class="pre">max_plot_vel</span></code> and <code class="docutils literal notranslate"><span class="pre">min_plot_vel</span></code>, values are pulled from above to limit bounds of the color bar to show the value of the specified variable, in this case it’s velocity in the x direction. The type of plot is also defined as a string ‘contour’ to add to the title of the plot.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Get layer data
layer = 2
layer_data = d3d.get_layer_data(d3d_data, variable, layer)

# Plotting
plt.figure(figsize=(12, 4))
contour_plot = plt.tricontourf(
    layer_data.x,
    layer_data.y,
    layer_data.v,
    vmin=min_plot_vel,
    vmax=max_plot_vel,
    levels=np.linspace(min_plot_vel, max_plot_vel, 10),
)

cbar = plt.colorbar(contour_plot)
cbar.set_label(&quot;$u_x$ [m/s]&quot;)

plt.xlabel(&quot;x [m]&quot;)
plt.ylabel(&quot;y [m]&quot;)
plt.title(f&quot;Velocity on Layer {layer} at Time: {layer_data.time[1]} s&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Velocity on Layer 2 at Time: 240.0 s&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Delft3D_example_15_1.png" src="_images/Delft3D_example_15_1.png" />
</div>
</div>
</section>
<section id="Plotting-a-Contour-Plot-of-a-given-Plane">
<h2>Plotting a Contour Plot of a given Plane<a class="headerlink" href="#Plotting-a-Contour-Plot-of-a-given-Plane" title="Link to this heading"></a></h2>
<p>If you wanted to look at a contour plot of a specific waterdepth you can create a contour plot over given points. Expanding on the centerline array points we can create a grid using the same <code class="docutils literal notranslate"><span class="pre">create_points</span></code> function by inputting two arrays along the length of the flume, <code class="docutils literal notranslate"><span class="pre">x</span></code> , and width of the flume, <code class="docutils literal notranslate"><span class="pre">y_contour</span></code> , and one point for the <code class="docutils literal notranslate"><span class="pre">waterdepth</span></code> we want to look at. <code class="docutils literal notranslate"><span class="pre">create_points</span></code> then outputs a dataframe <code class="docutils literal notranslate"><span class="pre">contour_points</span></code> of points to calculate the contour values over with the keys
<code class="docutils literal notranslate"><span class="pre">'x'</span></code>, <code class="docutils literal notranslate"><span class="pre">'y'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'waterdepth'</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Create x-y plane at z level midpoint
x2 = np.linspace(xmin, xmax, num=100)
y_contour = np.linspace(ymin, ymax, num=40)
z2 = np.mean([waterdepth_min, waterdepth_max])

contour_points = d3d.create_points(x2, y_contour, z2)
contour_points
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 1, 2]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>waterdepth</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17.875000</td>
      <td>4.875</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17.695707</td>
      <td>4.875</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>2</th>
      <td>17.516414</td>
      <td>4.875</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>3</th>
      <td>17.337121</td>
      <td>4.875</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.157828</td>
      <td>4.875</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3995</th>
      <td>0.842172</td>
      <td>1.125</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>3996</th>
      <td>0.662879</td>
      <td>1.125</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>3997</th>
      <td>0.483586</td>
      <td>1.125</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>3998</th>
      <td>0.304293</td>
      <td>1.125</td>
      <td>1.000931</td>
    </tr>
    <tr>
      <th>3999</th>
      <td>0.125000</td>
      <td>1.125</td>
      <td>1.000931</td>
    </tr>
  </tbody>
</table>
<p>4000 rows × 3 columns</p>
</div></div>
</div>
<p>Next the data is interpolated on to the points created and saved as an arrray under the variable name <code class="docutils literal notranslate"><span class="pre">contour_variable</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>contour_variable = interp.griddata(
    var_data_df[[&quot;x&quot;, &quot;y&quot;, &quot;waterdepth&quot;]],
    var_data_df[variable],
    contour_points[[&quot;x&quot;, &quot;y&quot;, &quot;waterdepth&quot;]],
)
</pre></div>
</div>
</div>
<p>The results are then plotted. The minimum and maximum values show on the graph are pulled from above (<code class="docutils literal notranslate"><span class="pre">max_plot_vel</span></code> and <code class="docutils literal notranslate"><span class="pre">min_plot_vel</span></code>) as in the previous example. The contour plot of the velocity is then output at the center waterdepth of the flume.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Plotting
plt.figure(figsize=(12, 4))
contour_plot = plt.tricontourf(
    contour_points.x,
    contour_points.y,
    contour_variable,
    vmin=min_plot_vel,
    vmax=max_plot_vel,
    levels=np.linspace(min_plot_vel, max_plot_vel, 10),
)

plt.xlabel(&quot;x (m)&quot;)
plt.ylabel(&quot;y (m)&quot;)
plt.title(f&quot;Velocity on x-y Plane&quot;)

cbar = plt.colorbar(contour_plot)
cbar.set_label(f&quot;$u_x$ [m/s]&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Delft3D_example_21_0.png" src="_images/Delft3D_example_21_0.png" />
</div>
</div>
</section>
<section id="Contour-Plot-of-Turbulent-Intensity">
<h2>Contour Plot of Turbulent Intensity<a class="headerlink" href="#Contour-Plot-of-Turbulent-Intensity" title="Link to this heading"></a></h2>
<p>Turbulent Intensity is the ratio of the magnitude of turbulent velocity to total velocity. The function <code class="docutils literal notranslate"><span class="pre">turbulent_intensity</span></code> takes the inputs of the NetCDF object, the points to caculate over, the time index, and an optional boolian input to output <code class="docutils literal notranslate"><span class="pre">intermediate_values</span></code> used to calculate turbulent intensity. The fuction then pulls variables <code class="docutils literal notranslate"><span class="pre">'ucx'</span></code>, <code class="docutils literal notranslate"><span class="pre">'ucy'</span></code>, <code class="docutils literal notranslate"><span class="pre">'ucz'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'turkin1'</span></code> as the velocity in the x, y, waterdepth and turbulence kinetic energy respectively. The function then
calculates and outputs the turbulent intensity, <code class="docutils literal notranslate"><span class="pre">turbulent_intensity</span></code>, for any given time_index in the data_frame <code class="docutils literal notranslate"><span class="pre">TI</span></code>. The <code class="docutils literal notranslate"><span class="pre">TI</span></code> dataframe also includes the <code class="docutils literal notranslate"><span class="pre">x</span></code>,<code class="docutils literal notranslate"><span class="pre">y</span></code>, and <code class="docutils literal notranslate"><span class="pre">waterdepth</span></code> location. If the <code class="docutils literal notranslate"><span class="pre">intermediate_values</span></code> bollian is equal to true the turbulent kinetic energy <code class="docutils literal notranslate"><span class="pre">'turkin1'</span></code>, and velocity in the <code class="docutils literal notranslate"><span class="pre">'ucx'</span></code>, <code class="docutils literal notranslate"><span class="pre">'ucy'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'ucz'</span></code> direction are also included.</p>
<p>In this example it is calculating the turbulent intensity over the same contour_points used above, however it can also calculate over ‘cells’, the coordinate system for the raw velocity data, or ‘faces’, the coordinate system for the raw turbulence data. If nothing is specified for <code class="docutils literal notranslate"><span class="pre">points</span></code>, <code class="docutils literal notranslate"><span class="pre">'cells'</span></code> is the default coordinate system.</p>
<p>Following the same format as the previous two contour plots the limits of the maximum and minimum values are defined by user as well as a string for the type of plot. The code then outputs a contour plot of the turbulent intensity.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Calculating turbulent intensity
TI = d3d.turbulent_intensity(d3d_data, points=contour_points, intermediate_values=True)

# Creating new plot limits
max_plot_TI = 27
min_plot_TI = 0

# Plotting
plt.figure(figsize=(12, 4))
contour_plot = plt.tricontourf(
    TI.x,
    TI.y,
    TI.turbulent_intensity,
    vmin=min_plot_TI,
    vmax=max_plot_TI,
    levels=np.linspace(min_plot_TI, max_plot_TI, 10),
)

plt.xlabel(&quot;x (m)&quot;)
plt.ylabel(&quot;y (m)&quot;)
plt.title(&quot;Turbulent Intensity&quot;)
cbar = plt.colorbar(contour_plot)
cbar.set_label(&quot;Turbulent Intensity [%]&quot;)

TI
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
points provided
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>waterdepth</th>
      <th>turkin1</th>
      <th>ucx</th>
      <th>ucy</th>
      <th>ucz</th>
      <th>turbulent_intensity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>17.875000</td>
      <td>4.875</td>
      <td>1.000931</td>
      <td>0.003148</td>
      <td>1.115198</td>
      <td>3.600628e-04</td>
      <td>-0.059917</td>
      <td>4.101755</td>
    </tr>
    <tr>
      <th>1</th>
      <td>17.695707</td>
      <td>4.875</td>
      <td>1.000931</td>
      <td>0.003091</td>
      <td>1.115302</td>
      <td>3.816327e-04</td>
      <td>0.079242</td>
      <td>4.060148</td>
    </tr>
    <tr>
      <th>2</th>
      <td>17.516414</td>
      <td>4.875</td>
      <td>1.000931</td>
      <td>0.003096</td>
      <td>1.112163</td>
      <td>3.603633e-04</td>
      <td>0.074341</td>
      <td>4.075892</td>
    </tr>
    <tr>
      <th>3</th>
      <td>17.337121</td>
      <td>4.875</td>
      <td>1.000931</td>
      <td>0.003013</td>
      <td>1.108294</td>
      <td>3.147688e-04</td>
      <td>-0.004829</td>
      <td>4.043806</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.157828</td>
      <td>4.875</td>
      <td>1.000931</td>
      <td>0.003029</td>
      <td>1.110058</td>
      <td>2.822649e-04</td>
      <td>-0.012586</td>
      <td>4.047740</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3995</th>
      <td>0.842172</td>
      <td>1.125</td>
      <td>1.000931</td>
      <td>0.000392</td>
      <td>1.058136</td>
      <td>-6.727795e-07</td>
      <td>-0.000070</td>
      <td>1.527464</td>
    </tr>
    <tr>
      <th>3996</th>
      <td>0.662879</td>
      <td>1.125</td>
      <td>1.000931</td>
      <td>0.000393</td>
      <td>1.057769</td>
      <td>-4.857739e-07</td>
      <td>0.011486</td>
      <td>1.529358</td>
    </tr>
    <tr>
      <th>3997</th>
      <td>0.483586</td>
      <td>1.125</td>
      <td>1.000931</td>
      <td>0.000399</td>
      <td>1.059054</td>
      <td>-3.423436e-07</td>
      <td>-0.005860</td>
      <td>1.540513</td>
    </tr>
    <tr>
      <th>3998</th>
      <td>0.304293</td>
      <td>1.125</td>
      <td>1.000931</td>
      <td>0.000374</td>
      <td>1.059019</td>
      <td>-2.209735e-07</td>
      <td>0.023087</td>
      <td>1.491256</td>
    </tr>
    <tr>
      <th>3999</th>
      <td>0.125000</td>
      <td>1.125</td>
      <td>1.000931</td>
      <td>0.000350</td>
      <td>1.056319</td>
      <td>-1.155897e-07</td>
      <td>0.135350</td>
      <td>1.434725</td>
    </tr>
  </tbody>
</table>
<p>4000 rows × 8 columns</p>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Delft3D_example_23_2.png" src="_images/Delft3D_example_23_2.png" />
</div>
</div>
</section>
<section id="Comparing-Face-Data-to-Cell-Data">
<h2>Comparing Face Data to Cell Data<a class="headerlink" href="#Comparing-Face-Data-to-Cell-Data" title="Link to this heading"></a></h2>
<p>In Delft3D there is a staggered grid where some variables are stored on the faces and some are stored on the cells. The <code class="docutils literal notranslate"><span class="pre">d3d.variable_interpolation</span></code> function allows you to linearly interpolate face data onto the cell locations or vice versa. For this example, we input the variable names, <code class="docutils literal notranslate"><span class="pre">'ucx'</span></code>, <code class="docutils literal notranslate"><span class="pre">'ucy'</span></code>,<code class="docutils literal notranslate"><span class="pre">'ucz'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'turkin1'</span></code>, which are pulled from the NetCDF object (<code class="docutils literal notranslate"><span class="pre">d3d_data</span></code>) and are to be interpolated on to the coordinate system <code class="docutils literal notranslate"><span class="pre">'faces'</span></code>. The output is a data frame,
<code class="docutils literal notranslate"><span class="pre">Var</span></code>, with the interpolated data.</p>
<p>Near the boundaries linear linterpolate will sometimes return negative values. When calculating turbulent intensity negative turbulent kinetic energy values (<code class="docutils literal notranslate"><span class="pre">turkin1</span></code>) will have and invalid answered. To filter out any negative values the index of where the negative numbers are located are calculated as <code class="docutils literal notranslate"><span class="pre">neg_index</span></code>. If the value is close to 0 (greater then -1.0e-4) the values is replaced with zero, if not it is replaced with nan. <code class="docutils literal notranslate"><span class="pre">zero_bool</span></code> determines if the negative number is close to 0.
<code class="docutils literal notranslate"><span class="pre">zero_ind</span></code> is the location of the negative numbers to be replaced with zero and <code class="docutils literal notranslate"><span class="pre">non_zero_bool</span></code> are the locations of the numbers to replace with nan. To calculate turbulent intensity the magnitude of the velocity is calculated with <code class="docutils literal notranslate"><span class="pre">'ucx'</span></code>, <code class="docutils literal notranslate"><span class="pre">'ucy'</span></code>, <code class="docutils literal notranslate"><span class="pre">'ucz'</span></code> and saved as <code class="docutils literal notranslate"><span class="pre">u_mag</span></code>.Turbulent intensity is then calculated with <code class="docutils literal notranslate"><span class="pre">u_mag</span></code> and <code class="docutils literal notranslate"><span class="pre">turkin1</span></code> and saved as <code class="docutils literal notranslate"><span class="pre">turbulent_intensity</span></code>.</p>
<p>Linear interpolate can also leave nan values near the edges of data. If you want fill these in using nearest interpolate set the values edges to equal <code class="docutils literal notranslate"><span class="pre">'nearest'</span></code> otherwis this option is dufalted to <code class="docutils literal notranslate"><span class="pre">'none'</span></code>.</p>
<p>The data can be called, as shown, with <code class="docutils literal notranslate"><span class="pre">Var</span></code>. We now have <code class="docutils literal notranslate"><span class="pre">'ucx'</span></code> and <code class="docutils literal notranslate"><span class="pre">'turkin1'</span></code> on the same grid so then can be compared and used in calculations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>variables = [&quot;turkin1&quot;, &quot;ucx&quot;, &quot;ucy&quot;, &quot;ucz&quot;]

Var = d3d.variable_interpolation(d3d_data, variables, points=&quot;faces&quot;, edges=&quot;nearest&quot;)

# Replacing negative numbers close to zero with zero
neg_index = np.where(Var[&quot;turkin1&quot;] &lt; 0)  # Finding negative numbers

# Determining if negative number are close to zero
zero_bool = np.isclose(
    Var[&quot;turkin1&quot;][Var[&quot;turkin1&quot;] &lt; 0].array,
    np.zeros(len(Var[&quot;turkin1&quot;][Var[&quot;turkin1&quot;] &lt; 0].array)),
    atol=1.0e-4,
)

# Identifying the location of negative values close to zero
zero_ind = neg_index[0][zero_bool]

# Identifying the location of negative number that are not close to zero
non_zero_ind = neg_index[0][~zero_bool]

# Replacing negative number close to zero with zero
Var.loc[zero_ind, &quot;turkin1&quot;] = np.zeros(len(zero_ind))

# Replacing negative numbers not close to zero with nan
Var.loc[non_zero_ind, &quot;turkin1&quot;] = [np.nan] * len(non_zero_ind)

# Calculating the root mean squared velocity
Var[&quot;u_mag&quot;] = d3d.unorm(
    np.array(Var[&quot;ucx&quot;]), np.array(Var[&quot;ucy&quot;]), np.array(Var[&quot;ucz&quot;])
)

# Calculating turbulent intensity as a percent
Var[&quot;turbulent_intensity&quot;] = (np.sqrt(2 / 3 * Var[&quot;turkin1&quot;]) / Var[&quot;u_mag&quot;]) * 100

Var
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>waterdepth</th>
      <th>turkin1</th>
      <th>ucx</th>
      <th>ucy</th>
      <th>ucz</th>
      <th>u_mag</th>
      <th>turbulent_intensity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.125</td>
      <td>1.125</td>
      <td>0.199485</td>
      <td>0.008562</td>
      <td>0.717881</td>
      <td>-1.531373e-07</td>
      <td>0.056840</td>
      <td>0.720128</td>
      <td>10.491394</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.375</td>
      <td>1.125</td>
      <td>0.200008</td>
      <td>0.008906</td>
      <td>0.689645</td>
      <td>-3.833700e-07</td>
      <td>-0.011832</td>
      <td>0.689746</td>
      <td>11.171384</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.125</td>
      <td>1.375</td>
      <td>0.199485</td>
      <td>0.009280</td>
      <td>0.717881</td>
      <td>-4.313024e-07</td>
      <td>0.056840</td>
      <td>0.720128</td>
      <td>10.922269</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.625</td>
      <td>1.125</td>
      <td>0.200056</td>
      <td>0.008780</td>
      <td>0.694164</td>
      <td>-6.750081e-07</td>
      <td>0.004593</td>
      <td>0.694179</td>
      <td>11.020928</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.375</td>
      <td>1.375</td>
      <td>0.200008</td>
      <td>0.008906</td>
      <td>0.689645</td>
      <td>-1.064686e-06</td>
      <td>-0.011832</td>
      <td>0.689746</td>
      <td>11.171384</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>5755</th>
      <td>17.625</td>
      <td>4.625</td>
      <td>1.794649</td>
      <td>0.000914</td>
      <td>1.245117</td>
      <td>9.389975e-04</td>
      <td>0.033098</td>
      <td>1.245558</td>
      <td>1.982237</td>
    </tr>
    <tr>
      <th>5756</th>
      <td>17.375</td>
      <td>4.875</td>
      <td>1.794848</td>
      <td>0.000903</td>
      <td>1.222989</td>
      <td>2.199022e-04</td>
      <td>0.000277</td>
      <td>1.222989</td>
      <td>2.006523</td>
    </tr>
    <tr>
      <th>5757</th>
      <td>17.875</td>
      <td>4.625</td>
      <td>1.799824</td>
      <td>0.000908</td>
      <td>1.255866</td>
      <td>8.894604e-04</td>
      <td>0.010782</td>
      <td>1.255913</td>
      <td>1.958613</td>
    </tr>
    <tr>
      <th>5758</th>
      <td>17.625</td>
      <td>4.875</td>
      <td>1.794638</td>
      <td>0.000907</td>
      <td>1.245292</td>
      <td>2.690449e-04</td>
      <td>0.033248</td>
      <td>1.245736</td>
      <td>1.973690</td>
    </tr>
    <tr>
      <th>5759</th>
      <td>17.875</td>
      <td>4.875</td>
      <td>1.799828</td>
      <td>0.000900</td>
      <td>1.256067</td>
      <td>2.501023e-04</td>
      <td>0.011193</td>
      <td>1.256117</td>
      <td>1.950496</td>
    </tr>
  </tbody>
</table>
<p>5760 rows × 9 columns</p>
</div></div>
</div>
<p>When plotting data using <code class="docutils literal notranslate"><span class="pre">d3d.variable_interpolation</span></code>it is helpful to define points to interpolate onto as the <code class="docutils literal notranslate"><span class="pre">'cell'</span></code> and <code class="docutils literal notranslate"><span class="pre">'face'</span></code> grids contain a 3 dimensional grid of points. In this next example we will use the <code class="docutils literal notranslate"><span class="pre">d3d.variable_interpolation</span></code> function to plot a contour plot of tubulent intesity normal to turbine (y-waterdepth cross section) <code class="docutils literal notranslate"><span class="pre">n</span></code> turbine diameters downstream of the turbine.</p>
<p>As stated in the intro, the turbine is located at 6m along the length <code class="docutils literal notranslate"><span class="pre">turbine_x_loc</span></code> with a diameter of 0.7m (<code class="docutils literal notranslate"><span class="pre">turbine_diameter</span></code>). Similar to the previous example, we input the variable names <code class="docutils literal notranslate"><span class="pre">variables</span></code> <code class="docutils literal notranslate"><span class="pre">'ucx'</span></code>, <code class="docutils literal notranslate"><span class="pre">'ucy'</span></code>,<code class="docutils literal notranslate"><span class="pre">'ucz'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'turkin1'</span></code>, which are pulled from the NetCDF object (<code class="docutils literal notranslate"><span class="pre">d3d_data</span></code>). Unlike the previous example, the points are defined as <code class="docutils literal notranslate"><span class="pre">sample_points</span></code> created using <code class="docutils literal notranslate"><span class="pre">create_points</span></code> from <code class="docutils literal notranslate"><span class="pre">x_sample</span></code>, <code class="docutils literal notranslate"><span class="pre">y_sample</span></code>, and <code class="docutils literal notranslate"><span class="pre">waterdepth_sample</span></code> with
<code class="docutils literal notranslate"><span class="pre">x_sample</span></code> at a constant point of 1 (<code class="docutils literal notranslate"><span class="pre">N</span></code>) turbine diameters downstream of the turbine (6.7m) and <code class="docutils literal notranslate"><span class="pre">y_sample</span></code> and <code class="docutils literal notranslate"><span class="pre">waterdepth_sample</span></code> being arrays between the minimum and maximum values for that flume dimension. The interpolated data is the saved from <code class="docutils literal notranslate"><span class="pre">d3d.variable_interpolation</span></code> as <code class="docutils literal notranslate"><span class="pre">Var_sample</span></code>and used to calculate turbulent intensity as in the previous example. The data is then plotted along the y and waterdepth axis.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>turbine_x_loc = 6
turbine_diameter = 0.7
N = 1
x_sample = turbine_x_loc + N * turbine_diameter
y_samples = np.linspace(ymin, ymax, num=40)
waterdepth_samples = np.linspace(waterdepth_min, waterdepth_max, num=256)

variables = [&quot;turkin1&quot;, &quot;ucx&quot;, &quot;ucy&quot;, &quot;ucz&quot;]
sample_points = d3d.create_points(x_sample, y_samples, waterdepth_samples)

Var_sample = d3d.variable_interpolation(
    d3d_data, variables, points=sample_points, edges=&quot;nearest&quot;
)

# root mean squared calculation
Var_sample[&quot;u_mag&quot;] = d3d.unorm(
    np.array(Var_sample[&quot;ucx&quot;]),
    np.array(Var_sample[&quot;ucy&quot;]),
    np.array(Var_sample[&quot;ucz&quot;]),
)
# turbulent intesity calculation
Var_sample[&quot;turbulent_intensity&quot;] = (
    np.sqrt(2 / 3 * Var_sample[&quot;turkin1&quot;]) / Var_sample[&quot;u_mag&quot;] * 100
)

# Plotting
plt.figure(figsize=(10, 4.4))
contour_plot = plt.tricontourf(
    Var_sample.y,
    Var_sample.waterdepth,
    Var_sample.turbulent_intensity,
    vmin=min_plot_TI,
    vmax=max_plot_TI,
    levels=np.linspace(min_plot_TI, max_plot_TI, 10),
)

plt.xlabel(&quot;y (m)&quot;)
plt.ylabel(&quot;z (m)&quot;)
plt.title(&quot;Turbulent Intensity&quot;)
cbar = plt.colorbar(contour_plot)
cbar.set_label(&quot;Turbulent Intensity [%]&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 1, 2]
points provided
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/Delft3D_example_27_1.png" src="_images/Delft3D_example_27_1.png" />
</div>
</div>
<p>This sample data used in this example is not spatial or temporally resolved and is for demonstration purposes only. In this example there are 5 sigma layers. The low level of discretization can be seen in in the sharp edges in the turbulent intensity plot above around the turbine.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, National Renewable Energy Laboratory, Pacific Northwest National Laboratory, and Sandia National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164358105-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-164358105-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>