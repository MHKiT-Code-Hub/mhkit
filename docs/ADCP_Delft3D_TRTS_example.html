<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Comparing Transect Data at the Tanana River Test Site &mdash; MHKiT v0.8.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/mhkit.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=17a23d02"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            MHKiT
          </a>
              <div class="version">
                v0.8.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">MHKiT-Python Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="matlab_installation.html">MHKiT-MATLAB Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="module.html">Module Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="webinars.html">Webinars</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="citeus.html">Cite Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Online Forum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MHKiT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Comparing Transect Data at the Tanana River Test Site</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/ADCP_Delft3D_TRTS_example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Comparing-Transect-Data-at-the-Tanana-River-Test-Site">
<h1>Comparing Transect Data at the Tanana River Test Site<a class="headerlink" href="#Comparing-Transect-Data-at-the-Tanana-River-Test-Site" title="Link to this heading"></a></h1>
<p>The TRTS is located near Nenana, Alaska, and was first investigated as a test site in 2008 after a CEC deployment in Eagle Alaska ended early due to debris-related issues. Since then, it has become an established test site with modular deployment infrastructure that can be adapted for different CEC deployments. The TRTS allows CECs to be tested in a harsh environment with cold temperatures, sediment, and heavy debris, representing the conditions of many remote Alaska river communities that could
greatly benefit from ME. The following example will familiarize the user with the MHKiT DOLfYN and Delft3D modules by performing a Deflt3d numerical model validation of the Tanana River Test Site (TRTS) against field data.</p>
<p>Start by importing the necessary python packages and MHKiT module.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">abspath</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">join</span><span class="p">,</span> <span class="n">normpath</span><span class="p">,</span> <span class="n">relpath</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">figure</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">interp</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">utm</span>

<span class="c1"># MHKiT Imports</span>
<span class="kn">from</span> <span class="nn">mhkit.dolfyn.rotate</span> <span class="kn">import</span> <span class="n">api</span> <span class="k">as</span> <span class="n">ap</span>
<span class="kn">from</span> <span class="nn">mhkit.dolfyn.adp</span> <span class="kn">import</span> <span class="n">api</span>
<span class="kn">from</span> <span class="nn">mhkit</span> <span class="kn">import</span> <span class="n">dolfyn</span> <span class="k">as</span> <span class="n">dlfn</span>
<span class="kn">from</span> <span class="nn">mhkit.river.io</span> <span class="kn">import</span> <span class="n">d3d</span>
<span class="kn">from</span> <span class="nn">mhkit</span> <span class="kn">import</span> <span class="n">river</span>
</pre></div>
</div>
</div>
<section id="1.-Preparing-the-ADCP-Field-Data">
<h2>1. Preparing the ADCP Field Data<a class="headerlink" href="#1.-Preparing-the-ADCP-Field-Data" title="Link to this heading"></a></h2>
<p>Acoustic Dopple Curent Profiler (ADCP) field data was collected in 2010 on the Tanana river near Nenana. From the picture shown below the flow can be seen enetering the picture from the bottom heading north. The figure further shows the two passes (Transects) of data collected. The data is collected using a barge used with a debris shield infront to protect instruments and test devices. The transect we are looking at are up-steam of the testing barge making them a good repesentiaion of the flow
field the Curent Energy Convertes (CEC) are operating in. This transect data was collected using a Teledyne Rio Grand ADCP monted at the Bow of the boat facing downward. The boat faced and moved perpendicular to the river flow across the river as the ADCP was recording.</p>
<p>In the next section we will import the two transects shown here into MHKiT and then interpolate these two passes into a single idealized transect for comparison with the simulated Deflt3D data.</p>
<p><img alt="d2e89ec1d3fb48ada2a721c02c36e34e" class="no-scaled-link" src="data/river/ADCP_transect/TRTS_transect_map.png" style="width: 1080px; height: 920px;" /></p>
<section id="ADCP:-Importing-Data">
<h3>ADCP: Importing Data<a class="headerlink" href="#ADCP:-Importing-Data" title="Link to this heading"></a></h3>
<p>The MHKiT DOLfYN api module can import <code class="docutils literal notranslate"><span class="pre">.PDO</span></code> and other binary formats from ADCP and ADV to an xarray. For this analysis we import two transect passes stored in the ‘data’ folder in <code class="docutils literal notranslate"><span class="pre">.PDO</span></code> format. For comparison to the numerical model we want to average the two transects into one xarray (‘transect_1_2’).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read in the two transect passes</span>
<span class="n">transect_1_raw</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="s2">&quot;data/river/ADCP_transect/tanana_transects_08_10_10_0_002_10-08-10_142214.PD0&quot;</span>
<span class="p">)</span>
<span class="n">transect_2_raw</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
    <span class="s2">&quot;data/river/ADCP_transect/tanana_transects_08_10_10_0_003_10-08-10_143335.PD0&quot;</span>
<span class="p">)</span>
<span class="c1"># Create one dataset from the two passes</span>
<span class="n">transect_1_2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">transect_1_raw</span><span class="p">,</span> <span class="n">transect_2_raw</span><span class="p">])</span>
<span class="c1"># Print the xarray data</span>
<span class="n">transect_1_2</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Reading file data/river/ADCP_transect/tanana_transects_08_10_10_0_002_10-08-10_142214.PD0 ...

Reading file data/river/ADCP_transect/tanana_transects_08_10_10_0_003_10-08-10_143335.PD0 ...
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:              (time_gps: 1171, time: 1171, beam: 4, dir: 4, range: 47, x: 4, x*: 4, earth: 3, inst: 3)
Coordinates:
  * time_gps             (time_gps) datetime64[ns] 2010-08-10T22:28:17.200000...
  * time                 (time) datetime64[ns] 2010-08-10T14:28:15.559999942 ...
  * beam                 (beam) int32 1 2 3 4
  * dir                  (dir) &lt;U3 &#x27;X&#x27; &#x27;Y&#x27; &#x27;Z&#x27; &#x27;err&#x27;
  * range                (range) float64 0.57 0.82 1.07 ... 11.57 11.82 12.07
  * x                    (x) int32 1 2 3 4
  * x*                   (x*) int32 1 2 3 4
  * earth                (earth) &lt;U1 &#x27;E&#x27; &#x27;N&#x27; &#x27;U&#x27;
  * inst                 (inst) &lt;U1 &#x27;X&#x27; &#x27;Y&#x27; &#x27;Z&#x27;
Data variables: (12/36)
    number               (time) float64 3.652e+03 3.653e+03 ... 4.882e+03
    builtin_test_fail    (time) float64 0.0 0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0
    c_sound              (time) float32 1.466e+03 1.466e+03 ... 1.466e+03
    depth                (time) float32 0.0 0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0
    pitch                (time) float32 -0.1 -0.09 -0.21 ... -0.37 -0.29 -0.11
    roll                 (time) float32 3.33 3.32 3.33 3.49 ... 2.34 2.37 2.38
    ...                   ...
    rtk_age_gps          (time_gps) float32 5.0 6.0 2.0 3.0 ... 2.0 2.0 3.0 3.0
    speed_over_grnd_gps  (time_gps) float32 0.03549 0.03395 ... 0.2541 0.285
    dir_over_grnd_gps    (time_gps) float32 115.5 94.08 6.931 ... 262.1 261.0
    hdwtime_gps          (time_gps) datetime64[ns] 2010-08-10T14:28:15.559999...
    beam2inst_orientmat  (x, x*) float64 1.462 -1.462 0.0 ... -1.034 -1.034
    orientmat            (earth, inst, time) float64 -0.9037 -0.9025 ... 1.0 1.0
Attributes: (12/38)
    inst_make:                TRDI
    inst_type:                ADCP
    rotate_vars:              [&#x27;vel&#x27;, &#x27;vel_bt&#x27;]
    has_imu:                  0
    prog_ver:                 10.16
    inst_model:               Rio Grande
    ...                       ...
    false_target_threshold:   50
    transmit_lag_m:           0.08
    bandwidth:                0
    sourceprog:               WINRIVER
    fs:                       11.11111111111111
    vel_gps_corrected:        0</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-8caa833f-380a-4c3f-a6a8-fa096fd43e29' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-8caa833f-380a-4c3f-a6a8-fa096fd43e29' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time_gps</span>: 1171</li><li><span class='xr-has-index'>time</span>: 1171</li><li><span class='xr-has-index'>beam</span>: 4</li><li><span class='xr-has-index'>dir</span>: 4</li><li><span class='xr-has-index'>range</span>: 47</li><li><span class='xr-has-index'>x</span>: 4</li><li><span class='xr-has-index'>x*</span>: 4</li><li><span class='xr-has-index'>earth</span>: 3</li><li><span class='xr-has-index'>inst</span>: 3</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-dcd663a6-57d3-4145-a81d-c2b2b4735d23' class='xr-section-summary-in' type='checkbox'  checked><label for='section-dcd663a6-57d3-4145-a81d-c2b2b4735d23' class='xr-section-summary' >Coordinates: <span>(9)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2010-08-10T22:28:17.200000047 .....</div><input id='attrs-fafe4ad3-1ae1-42a4-845e-9283b41dc6fb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fafe4ad3-1ae1-42a4-845e-9283b41dc6fb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e50b4df9-652d-4ab8-b00f-1c7c0ccb7d0b' class='xr-var-data-in' type='checkbox'><label for='data-e50b4df9-652d-4ab8-b00f-1c7c0ccb7d0b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2010-08-10T22:28:17.200000047&#x27;, &#x27;2010-08-10T22:28:18.000000000&#x27;,
       &#x27;2010-08-10T22:28:18.599999904&#x27;, ..., &#x27;2010-08-10T22:39:44.400000095&#x27;,
       &#x27;2010-08-10T22:39:45.200000047&#x27;, &#x27;2010-08-10T22:39:45.799999952&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2010-08-10T14:28:15.559999942 .....</div><input id='attrs-629df985-a626-4800-8359-087a007e7b56' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-629df985-a626-4800-8359-087a007e7b56' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-347625b0-e9e4-4e42-9fba-a6421c3367ad' class='xr-var-data-in' type='checkbox'><label for='data-347625b0-e9e4-4e42-9fba-a6421c3367ad' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2010-08-10T14:28:15.559999942&#x27;, &#x27;2010-08-10T14:28:16.319999933&#x27;,
       &#x27;2010-08-10T14:28:17.069999933&#x27;, ..., &#x27;2010-08-10T14:39:42.710000038&#x27;,
       &#x27;2010-08-10T14:39:43.500000000&#x27;, &#x27;2010-08-10T14:39:44.279999971&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>beam</span></div><div class='xr-var-dims'>(beam)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>1 2 3 4</div><input id='attrs-fa5af6ea-543e-4237-862a-a95c4d9804fb' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-fa5af6ea-543e-4237-862a-a95c4d9804fb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0aab9823-9be2-4763-b8db-888763bcc49b' class='xr-var-data-in' type='checkbox'><label for='data-0aab9823-9be2-4763-b8db-888763bcc49b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3, 4])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>dir</span></div><div class='xr-var-dims'>(dir)</div><div class='xr-var-dtype'>&lt;U3</div><div class='xr-var-preview xr-preview'>&#x27;X&#x27; &#x27;Y&#x27; &#x27;Z&#x27; &#x27;err&#x27;</div><input id='attrs-5e40095a-43b9-4ccf-8335-9044794534a8' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5e40095a-43b9-4ccf-8335-9044794534a8' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-941fa3f2-f776-4379-962a-4a7f56d4efe2' class='xr-var-data-in' type='checkbox'><label for='data-941fa3f2-f776-4379-962a-4a7f56d4efe2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>ref_frame :</span></dt><dd>ship</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;, &#x27;err&#x27;], dtype=&#x27;&lt;U3&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>range</span></div><div class='xr-var-dims'>(range)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.57 0.82 1.07 ... 11.82 12.07</div><input id='attrs-cf9522c6-30fc-46db-8445-f25481142f93' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-cf9522c6-30fc-46db-8445-f25481142f93' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fe7d528a-c952-4ab7-9e98-127a53ddcd75' class='xr-var-data-in' type='checkbox'><label for='data-fe7d528a-c952-4ab7-9e98-127a53ddcd75' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m</dd></dl></div><div class='xr-var-data'><pre>array([ 0.57,  0.82,  1.07,  1.32,  1.57,  1.82,  2.07,  2.32,  2.57,  2.82,
        3.07,  3.32,  3.57,  3.82,  4.07,  4.32,  4.57,  4.82,  5.07,  5.32,
        5.57,  5.82,  6.07,  6.32,  6.57,  6.82,  7.07,  7.32,  7.57,  7.82,
        8.07,  8.32,  8.57,  8.82,  9.07,  9.32,  9.57,  9.82, 10.07, 10.32,
       10.57, 10.82, 11.07, 11.32, 11.57, 11.82, 12.07])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>1 2 3 4</div><input id='attrs-6961d667-45e5-4512-a62d-50206e0ff43a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6961d667-45e5-4512-a62d-50206e0ff43a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-59d08142-716b-4088-a1ef-798b5f81af5e' class='xr-var-data-in' type='checkbox'><label for='data-59d08142-716b-4088-a1ef-798b5f81af5e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3, 4])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x*</span></div><div class='xr-var-dims'>(x*)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>1 2 3 4</div><input id='attrs-6f36fafc-e3cc-4477-bd50-eb08f4445807' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-6f36fafc-e3cc-4477-bd50-eb08f4445807' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-39a47221-ece1-4a75-811d-3ca87b0f2dc7' class='xr-var-data-in' type='checkbox'><label for='data-39a47221-ece1-4a75-811d-3ca87b0f2dc7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3, 4])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>earth</span></div><div class='xr-var-dims'>(earth)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;E&#x27; &#x27;N&#x27; &#x27;U&#x27;</div><input id='attrs-3e9d18d1-d539-42c6-ae42-2afba1d2ba50' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-3e9d18d1-d539-42c6-ae42-2afba1d2ba50' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-352ad48e-0850-43b4-b36e-7d2ca0e90654' class='xr-var-data-in' type='checkbox'><label for='data-352ad48e-0850-43b4-b36e-7d2ca0e90654' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;E&#x27;, &#x27;N&#x27;, &#x27;U&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>inst</span></div><div class='xr-var-dims'>(inst)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;X&#x27; &#x27;Y&#x27; &#x27;Z&#x27;</div><input id='attrs-02e44410-2cb2-492e-b476-39f601daf3c9' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-02e44410-2cb2-492e-b476-39f601daf3c9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4766db80-cfae-45e4-9386-c2aa70b897cd' class='xr-var-data-in' type='checkbox'><label for='data-4766db80-cfae-45e4-9386-c2aa70b897cd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-3d59105b-f251-4aa7-b9fe-a4ac66c9fd7d' class='xr-section-summary-in' type='checkbox'  ><label for='section-3d59105b-f251-4aa7-b9fe-a4ac66c9fd7d' class='xr-section-summary' >Data variables: <span>(36)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>number</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>3.652e+03 3.653e+03 ... 4.882e+03</div><input id='attrs-ff4534fa-7f91-4024-823a-7701031bda7e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ff4534fa-7f91-4024-823a-7701031bda7e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bd14e3ea-6de1-4baf-9cdf-76322a235156' class='xr-var-data-in' type='checkbox'><label for='data-bd14e3ea-6de1-4baf-9cdf-76322a235156' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd></dd></dl></div><div class='xr-var-data'><pre>array([3652., 3653., 3654., ..., 4880., 4881., 4882.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>builtin_test_fail</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-031de62c-934b-401f-92f1-275e69e2cc40' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-031de62c-934b-401f-92f1-275e69e2cc40' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e387b223-8c12-4864-9477-3e14745e05d3' class='xr-var-data-in' type='checkbox'><label for='data-e387b223-8c12-4864-9477-3e14745e05d3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd></dd></dl></div><div class='xr-var-data'><pre>array([0., 0., 0., ..., 0., 0., 0.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>c_sound</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>1.466e+03 1.466e+03 ... 1.466e+03</div><input id='attrs-84cff3fe-8aa2-449a-bb63-6c663abe1a7e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-84cff3fe-8aa2-449a-bb63-6c663abe1a7e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-59847c47-d54f-4e2a-9224-f91936041cb3' class='xr-var-data-in' type='checkbox'><label for='data-59847c47-d54f-4e2a-9224-f91936041cb3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m/s</dd></dl></div><div class='xr-var-data'><pre>array([1466., 1466., 1466., ..., 1466., 1466., 1466.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>depth</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-64ab2d0a-a3ec-4fcf-bbf0-34d4302fb2ba' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-64ab2d0a-a3ec-4fcf-bbf0-34d4302fb2ba' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5a106f28-fe75-41ea-93fd-1d2467900f26' class='xr-var-data-in' type='checkbox'><label for='data-5a106f28-fe75-41ea-93fd-1d2467900f26' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m</dd></dl></div><div class='xr-var-data'><pre>array([0., 0., 0., ..., 0., 0., 0.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>pitch</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-0.1 -0.09 -0.21 ... -0.29 -0.11</div><input id='attrs-bf0a880b-65d4-4df4-af23-7a94325f7e0e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-bf0a880b-65d4-4df4-af23-7a94325f7e0e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-61c59bc3-9154-4bb0-b9e1-d3658c8015ec' class='xr-var-data-in' type='checkbox'><label for='data-61c59bc3-9154-4bb0-b9e1-d3658c8015ec' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([-0.1 , -0.09, -0.21, ..., -0.37, -0.29, -0.11], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>roll</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>3.33 3.32 3.33 ... 2.34 2.37 2.38</div><input id='attrs-f7b103a1-489b-4439-83eb-1d8a8bd152df' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f7b103a1-489b-4439-83eb-1d8a8bd152df' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-33ca51fc-ef99-4e56-91ba-d4557f57bb4e' class='xr-var-data-in' type='checkbox'><label for='data-33ca51fc-ef99-4e56-91ba-d4557f57bb4e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([3.33, 3.32, 3.33, ..., 2.34, 2.37, 2.38], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>heading</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>154.6 154.5 155.0 ... 163.6 163.0</div><input id='attrs-86f982ea-62a3-4b58-9ec9-1b22d1c98a4a' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-86f982ea-62a3-4b58-9ec9-1b22d1c98a4a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-06e886e3-9228-4b78-b012-4361320a74ee' class='xr-var-data-in' type='checkbox'><label for='data-06e886e3-9228-4b78-b012-4361320a74ee' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([154.65, 154.49, 155.01, ..., 162.91, 163.61, 163.03], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>temp</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>15.2 15.25 15.23 ... 15.18 15.15</div><input id='attrs-7dba413c-e11a-4ff0-bfbb-fba7da830d3e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-7dba413c-e11a-4ff0-bfbb-fba7da830d3e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-21334e89-b1f1-46d6-bf20-68f2fa136bc6' class='xr-var-data-in' type='checkbox'><label for='data-21334e89-b1f1-46d6-bf20-68f2fa136bc6' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>C</dd></dl></div><div class='xr-var-data'><pre>array([15.2 , 15.25, 15.23, ..., 15.19, 15.18, 15.15], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>salinity</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-546657bb-3620-4ae3-973d-62fed2c411d2' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-546657bb-3620-4ae3-973d-62fed2c411d2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9cc8c066-aed5-44a2-b183-4c73466fd019' class='xr-var-data-in' type='checkbox'><label for='data-9cc8c066-aed5-44a2-b183-4c73466fd019' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>psu</dd></dl></div><div class='xr-var-data'><pre>array([0., 0., 0., ..., 0., 0., 0.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>min_preping_wait</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-74ebed10-ae2c-4169-a8b1-a4ce6120fcfa' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-74ebed10-ae2c-4169-a8b1-a4ce6120fcfa' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-25bd9077-7320-42d1-9628-fac99db21efd' class='xr-var-data-in' type='checkbox'><label for='data-25bd9077-7320-42d1-9628-fac99db21efd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>s</dd></dl></div><div class='xr-var-data'><pre>array([0., 0., 0., ..., 0., 0., 0.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>heading_std</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-ed97f8a4-d226-4342-81e6-2b7dd618b9db' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ed97f8a4-d226-4342-81e6-2b7dd618b9db' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-091d38d9-50c7-44cd-abd5-2a6c995de08d' class='xr-var-data-in' type='checkbox'><label for='data-091d38d9-50c7-44cd-abd5-2a6c995de08d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([0., 0., 0., ..., 0., 0., 0.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>pitch_std</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-106931bd-4b9a-4956-a441-1503c2521644' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-106931bd-4b9a-4956-a441-1503c2521644' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ab874b1a-f4be-4ea8-bc05-10b18cda8cc2' class='xr-var-data-in' type='checkbox'><label for='data-ab874b1a-f4be-4ea8-bc05-10b18cda8cc2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([0., 0., 0., ..., 0., 0., 0.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>roll_std</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-19f96eb0-438a-4486-94e1-bb4f31b96d0d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-19f96eb0-438a-4486-94e1-bb4f31b96d0d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e6e615e0-b21f-4c3b-a722-1a4e8d171ed0' class='xr-var-data-in' type='checkbox'><label for='data-e6e615e0-b21f-4c3b-a722-1a4e8d171ed0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([0., 0., 0., ..., 0., 0., 0.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>pressure</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-aeeeabff-45f9-4c1b-a40a-fa9f9f290997' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-aeeeabff-45f9-4c1b-a40a-fa9f9f290997' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5f866ee8-5338-487f-83f9-f4b5c4988b88' class='xr-var-data-in' type='checkbox'><label for='data-5f866ee8-5338-487f-83f9-f4b5c4988b88' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>dbar</dd></dl></div><div class='xr-var-data'><pre>array([0., 0., 0., ..., 0., 0., 0.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>pressure_std</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-f9dd13a4-6562-4bea-8898-995174b7f372' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f9dd13a4-6562-4bea-8898-995174b7f372' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8018acbd-ac5a-4cb5-9ef7-7f45330bd12e' class='xr-var-data-in' type='checkbox'><label for='data-8018acbd-ac5a-4cb5-9ef7-7f45330bd12e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>dbar</dd></dl></div><div class='xr-var-data'><pre>array([0., 0., 0., ..., 0., 0., 0.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>vel</span></div><div class='xr-var-dims'>(dir, range, time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.057 -0.192 0.121 ... nan nan nan</div><input id='attrs-aafeaf74-48b8-40f9-8bf6-66dcc2f76ab7' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-aafeaf74-48b8-40f9-8bf6-66dcc2f76ab7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3bc1b807-55a9-4242-8619-3bd804ce7dc0' class='xr-var-data-in' type='checkbox'><label for='data-3bc1b807-55a9-4242-8619-3bd804ce7dc0' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m/s</dd></dl></div><div class='xr-var-data'><pre>array([[[ 0.057, -0.192,  0.121, ...,  0.129,  0.055,  0.133],
        [-0.058, -0.131, -0.119, ..., -0.006, -0.124,  0.043],
        [ 0.059,  0.406,  0.067, ...,  0.068, -0.213, -0.199],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[-0.227, -0.047, -0.151, ..., -0.773, -0.553, -0.477],
        [ 0.023, -0.158,  0.204, ..., -0.961, -0.591,  0.123],
        [-0.303, -0.215, -0.019, ..., -0.672, -0.791, -0.384],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[-0.01 ,  0.022, -0.119, ...,  0.108,  0.186,  0.231],
        [-0.074, -0.01 , -0.06 , ...,  0.144,  0.185,  0.18 ],
        [-0.042, -0.013, -0.067, ...,  0.046,  0.163,  0.312],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]],

       [[ 0.26 , -0.043, -0.087, ..., -0.258,  0.088, -0.147],
        [ 0.102,  0.111, -0.204, ..., -0.072,  0.075,  0.225],
        [ 0.324, -0.038,  0.214, ..., -0.429,  0.558,  0.188],
        ...,
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan],
        [   nan,    nan,    nan, ...,    nan,    nan,    nan]]],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>amp</span></div><div class='xr-var-dims'>(beam, range, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>224.0 229.0 225.0 ... 52.0 53.0</div><input id='attrs-425f5731-85d8-460c-95d2-0fdf9510038c' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-425f5731-85d8-460c-95d2-0fdf9510038c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d51022f4-3661-404c-a535-512928c553f4' class='xr-var-data-in' type='checkbox'><label for='data-d51022f4-3661-404c-a535-512928c553f4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>counts</dd></dl></div><div class='xr-var-data'><pre>array([[[224., 229., 225., ..., 231., 227., 228.],
        [222., 222., 221., ..., 223., 224., 224.],
        [217., 215., 214., ..., 222., 220., 220.],
        ...,
        [ 53.,  54.,  54., ...,  51.,  53.,  54.],
        [ 52.,  53.,  52., ...,  53.,  53.,  49.],
        [ 54.,  53.,  52., ...,  51.,  53.,  52.]],

       [[207., 213., 210., ..., 212., 215., 212.],
        [212., 210., 205., ..., 213., 210., 209.],
        [201., 205., 204., ..., 206., 210., 207.],
        ...,
        [ 46.,  51.,  46., ...,  46.,  44.,  45.],
        [ 43.,  55.,  45., ...,  44.,  45.,  42.],
        [ 45.,  51.,  44., ...,  41.,  45.,  43.]],

       [[223., 226., 225., ..., 227., 230., 227.],
        [219., 220., 219., ..., 220., 224., 223.],
        [213., 213., 216., ..., 220., 218., 224.],
        ...,
        [ 49.,  53.,  51., ...,  55.,  52.,  48.],
        [ 52.,  57.,  52., ...,  53.,  53.,  49.],
        [ 50.,  53.,  50., ...,  50.,  51.,  50.]],

       [[215., 214., 217., ..., 216., 217., 218.],
        [215., 208., 211., ..., 210., 213., 213.],
        [207., 212., 203., ..., 205., 207., 211.],
        ...,
        [ 51.,  57.,  52., ...,  51.,  55.,  53.],
        [ 52.,  58.,  53., ...,  52.,  53.,  50.],
        [ 51.,  60.,  50., ...,  52.,  52.,  53.]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>corr</span></div><div class='xr-var-dims'>(beam, range, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>124.0 118.0 130.0 ... 24.0 29.0</div><input id='attrs-58f9bc9c-727f-4896-8e84-e9da91aac199' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-58f9bc9c-727f-4896-8e84-e9da91aac199' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2e81beab-d0d3-4160-a4a9-3ac9b6f528f4' class='xr-var-data-in' type='checkbox'><label for='data-2e81beab-d0d3-4160-a4a9-3ac9b6f528f4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>counts</dd></dl></div><div class='xr-var-data'><pre>array([[[124., 118., 130., ..., 139., 122., 116.],
        [128., 140., 128., ..., 128., 126., 126.],
        [132., 119., 119., ..., 132., 118., 123.],
        ...,
        [ 18.,  17.,  19., ...,  23.,  11.,  25.],
        [ 11.,  21.,  22., ...,  24.,  17.,  19.],
        [ 17.,  11.,  11., ...,   9.,  27.,  27.]],

       [[128., 110., 118., ..., 127., 128., 140.],
        [126., 115., 127., ..., 136., 126., 108.],
        [128., 131., 120., ..., 133., 140., 121.],
        ...,
        [ 16.,  14.,  24., ...,   7.,  14.,  15.],
        [ 13.,  11.,  22., ...,  21.,  19.,   8.],
        [ 34.,  18.,  17., ...,  25.,  33.,  19.]],

       [[114., 132., 123., ..., 129., 132., 126.],
        [139., 142., 110., ..., 120., 120., 124.],
        [124., 122., 121., ..., 126., 123., 133.],
        ...,
        [ 12.,  16.,  17., ...,   7.,  25.,  31.],
        [ 11.,  17.,  17., ...,  21.,  23.,  35.],
        [ 17.,  17.,  11., ...,  11.,  17.,  24.]],

       [[118., 142., 130., ..., 133., 122., 130.],
        [142., 120., 137., ..., 129., 120., 130.],
        [110., 121., 126., ..., 125., 132., 120.],
        ...,
        [ 19.,  13.,  17., ...,  39.,  14.,  29.],
        [  7.,  25.,  16., ...,  16.,  13.,  15.],
        [ 13.,  25.,  13., ...,  19.,  24.,  29.]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>prcnt_gd</span></div><div class='xr-var-dims'>(beam, range, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0</div><input id='attrs-74e33c4b-3fa8-4d27-89d3-684d31ce66ab' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-74e33c4b-3fa8-4d27-89d3-684d31ce66ab' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-fedb1896-e7ec-4513-a7ec-c55a50aaca1e' class='xr-var-data-in' type='checkbox'><label for='data-fedb1896-e7ec-4513-a7ec-c55a50aaca1e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>%</dd></dl></div><div class='xr-var-data'><pre>array([[[  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        ...,
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.]],

       [[  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        ...,
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.]],

       [[  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        ...,
        [100., 100., 100., ..., 100., 100., 100.],
        [100., 100., 100., ..., 100., 100., 100.],
        [100., 100., 100., ..., 100., 100., 100.]],

       [[100., 100., 100., ..., 100., 100., 100.],
        [100., 100., 100., ..., 100., 100., 100.],
        [100., 100., 100., ..., 100., 100., 100.],
        ...,
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.],
        [  0.,   0.,   0., ...,   0.,   0.,   0.]]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>dist_bt</span></div><div class='xr-var-dims'>(beam, time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>3.95 3.95 3.96 ... 3.09 2.92 2.98</div><input id='attrs-647c7368-93dd-4300-b380-78261ff0efe7' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-647c7368-93dd-4300-b380-78261ff0efe7' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-39c4eaba-57b3-42b6-b7ab-98a4d34ed6f4' class='xr-var-data-in' type='checkbox'><label for='data-39c4eaba-57b3-42b6-b7ab-98a4d34ed6f4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m</dd></dl></div><div class='xr-var-data'><pre>array([[3.95, 3.95, 3.96, ..., 3.6 , 3.54, 3.46],
       [2.55, 2.56, 2.57, ..., 2.71, 2.67, 2.62],
       [3.31, 3.32, 3.33, ..., 3.09, 3.04, 2.98],
       [2.87, 2.88, 2.88, ..., 3.09, 2.92, 2.98]], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>vel_bt</span></div><div class='xr-var-dims'>(dir, time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.063 -0.004 0.039 ... 0.0 0.004</div><input id='attrs-ef2d7723-f3e1-48db-9c68-2bd5a5bbd892' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ef2d7723-f3e1-48db-9c68-2bd5a5bbd892' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-70076635-f464-48d7-83d5-8c2d1982d7f7' class='xr-var-data-in' type='checkbox'><label for='data-70076635-f464-48d7-83d5-8c2d1982d7f7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m/s</dd></dl></div><div class='xr-var-data'><pre>array([[ 6.3000e-02, -4.0000e-03,  3.9000e-02, ..., -2.6400e-01,
        -2.5200e-01, -2.5300e-01],
       [-3.7000e-02,  1.9000e-02,  1.5000e-02, ..., -1.0100e-01,
        -9.1000e-02, -9.2000e-02],
       [ 9.0000e-03,  0.0000e+00,  8.0000e-03, ..., -2.0000e-03,
         5.0000e-03, -2.0000e-03],
       [-1.0000e-02, -6.0000e-03, -3.2768e+01, ...,  1.0000e-03,
         0.0000e+00,  4.0000e-03]], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>corr_bt</span></div><div class='xr-var-dims'>(beam, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>231.0 243.0 242.0 ... 239.0 245.0</div><input id='attrs-59a5246f-9174-4099-98d7-76cf017acc7e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-59a5246f-9174-4099-98d7-76cf017acc7e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-f57f039d-9c1d-4e81-96a2-ee84c6a8d612' class='xr-var-data-in' type='checkbox'><label for='data-f57f039d-9c1d-4e81-96a2-ee84c6a8d612' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>counts</dd></dl></div><div class='xr-var-data'><pre>array([[231., 243., 242., ..., 246., 250., 236.],
       [229., 239., 246., ..., 250., 253., 234.],
       [223., 237.,   0., ..., 248., 246., 248.],
       [248., 244., 250., ..., 233., 239., 245.]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>amp_bt</span></div><div class='xr-var-dims'>(beam, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>40.0 40.0 36.0 ... 42.0 63.0 62.0</div><input id='attrs-ab8f4f70-3df3-4433-b693-d8f02b58fba4' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ab8f4f70-3df3-4433-b693-d8f02b58fba4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-128ba238-ff56-409a-9fbf-7175d25baf97' class='xr-var-data-in' type='checkbox'><label for='data-128ba238-ff56-409a-9fbf-7175d25baf97' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>counts</dd></dl></div><div class='xr-var-data'><pre>array([[40., 40., 36., ..., 58., 63., 49.],
       [45., 38., 47., ..., 67., 79., 67.],
       [40., 43., 36., ..., 62., 53., 53.],
       [55., 54., 52., ..., 42., 63., 62.]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>prcnt_gd_bt</span></div><div class='xr-var-dims'>(beam, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>0.0 0.0 100.0 ... 100.0 100.0 100.0</div><input id='attrs-aeace985-9a31-4ede-be52-e3cf77cdb19c' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-aeace985-9a31-4ede-be52-e3cf77cdb19c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7a01bc32-29ca-4f6b-a004-20aa48c36f57' class='xr-var-data-in' type='checkbox'><label for='data-7a01bc32-29ca-4f6b-a004-20aa48c36f57' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>%</dd></dl></div><div class='xr-var-data'><pre>array([[  0.,   0., 100., ...,   0.,   0.,   0.],
       [  0.,   0.,   0., ...,   0.,   0.,   0.],
       [  0.,   0.,   0., ...,   0.,   0.,   0.],
       [100., 100.,   0., ..., 100., 100., 100.]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>64.56 64.56 64.56 ... 64.56 64.56</div><input id='attrs-2bb83b0f-9d92-4355-9596-bd95b73d722c' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-2bb83b0f-9d92-4355-9596-bd95b73d722c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2b0c6559-f2bb-4fff-a611-93976cc0840d' class='xr-var-data-in' type='checkbox'><label for='data-2b0c6559-f2bb-4fff-a611-93976cc0840d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([64.560905, 64.560905, 64.560905, ..., 64.56095 , 64.56095 ,
       64.56095 ], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>longitude_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-149.1 -149.1 ... -149.1 -149.1</div><input id='attrs-3310c4df-4e62-4e01-926e-af953aa213aa' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-3310c4df-4e62-4e01-926e-af953aa213aa' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-582e3a1b-b36a-4429-b3a1-7689533924ee' class='xr-var-data-in' type='checkbox'><label for='data-582e3a1b-b36a-4429-b3a1-7689533924ee' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([-149.06679, -149.06679, -149.06679, ..., -149.06676, -149.06676,
       -149.06677], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>fix_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>9.0 9.0 9.0 9.0 ... 9.0 9.0 9.0 9.0</div><input id='attrs-aea3147e-91b5-4aa6-9b6e-f13dc25e3f3e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-aea3147e-91b5-4aa6-9b6e-f13dc25e3f3e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3804ca8f-9108-48ef-86db-0efefb70142c' class='xr-var-data-in' type='checkbox'><label for='data-3804ca8f-9108-48ef-86db-0efefb70142c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>1</dd></dl></div><div class='xr-var-data'><pre>array([9., 9., 9., ..., 9., 9., 9.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>n_sat_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>9.0 9.0 9.0 9.0 ... 10.0 10.0 10.0</div><input id='attrs-3146c84e-30c5-4ef2-9648-509ed8a430c9' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-3146c84e-30c5-4ef2-9648-509ed8a430c9' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-47b89060-45e9-41ee-8f8a-30c12b482fbf' class='xr-var-data-in' type='checkbox'><label for='data-47b89060-45e9-41ee-8f8a-30c12b482fbf' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>count</dd></dl></div><div class='xr-var-data'><pre>array([ 9.,  9.,  9., ..., 10., 10., 10.])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>hdop_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.9 0.9 0.9 0.9 ... 0.8 0.8 0.8 0.8</div><input id='attrs-3f6f6a84-e1fb-4676-9e87-c6a1dfdc0106' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-3f6f6a84-e1fb-4676-9e87-c6a1dfdc0106' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1ae4e48d-ca22-43f4-b111-3726caaf4750' class='xr-var-data-in' type='checkbox'><label for='data-1ae4e48d-ca22-43f4-b111-3726caaf4750' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>1</dd></dl></div><div class='xr-var-data'><pre>array([0.9, 0.9, 0.9, ..., 0.8, 0.8, 0.8], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>elevation_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>108.5 108.2 108.2 ... 108.7 108.7</div><input id='attrs-1e26b31a-f2e9-4820-9c23-6ff42484a323' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-1e26b31a-f2e9-4820-9c23-6ff42484a323' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1d4b9fb7-7aa8-4ab7-bca0-027748a9f73b' class='xr-var-data-in' type='checkbox'><label for='data-1d4b9fb7-7aa8-4ab7-bca0-027748a9f73b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m</dd></dl></div><div class='xr-var-data'><pre>array([108.483, 108.196, 108.208, ..., 108.659, 108.655, 108.668],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>rtk_age_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>5.0 6.0 2.0 3.0 ... 2.0 2.0 3.0 3.0</div><input id='attrs-e11900d7-b975-42a1-a263-4d2709baf5a3' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-e11900d7-b975-42a1-a263-4d2709baf5a3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-afae3bac-d89c-488d-a84d-93cde65d8292' class='xr-var-data-in' type='checkbox'><label for='data-afae3bac-d89c-488d-a84d-93cde65d8292' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>s</dd></dl></div><div class='xr-var-data'><pre>array([5., 6., 2., ..., 2., 3., 3.], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>speed_over_grnd_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.03549 0.03395 ... 0.2541 0.285</div><input id='attrs-1ca97b14-166f-406a-ad64-908f02e6fd89' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-1ca97b14-166f-406a-ad64-908f02e6fd89' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c6a7bcee-b507-4c2b-9fa3-9a34b02d17c7' class='xr-var-data-in' type='checkbox'><label for='data-c6a7bcee-b507-4c2b-9fa3-9a34b02d17c7' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m/s</dd></dl></div><div class='xr-var-data'><pre>array([0.03549382, 0.03395062, 0.03858025, ..., 0.29166666, 0.25411522,
       0.28497943], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>dir_over_grnd_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>115.5 94.08 6.931 ... 262.1 261.0</div><input id='attrs-aca2110c-8769-483a-8430-de133ac934ba' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-aca2110c-8769-483a-8430-de133ac934ba' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-978b1114-df39-4fc7-bc2a-96379fbd776c' class='xr-var-data-in' type='checkbox'><label for='data-978b1114-df39-4fc7-bc2a-96379fbd776c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([115.501,  94.077,   6.931, ..., 255.591, 262.114, 261.019],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>hdwtime_gps</span></div><div class='xr-var-dims'>(time_gps)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2010-08-10T14:28:15.559999942 .....</div><input id='attrs-bd7e5b51-99b2-4a8c-a508-6307bbe13e33' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-bd7e5b51-99b2-4a8c-a508-6307bbe13e33' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6c5e990d-d43c-4a32-8e11-1271b81dd9cb' class='xr-var-data-in' type='checkbox'><label for='data-6c5e990d-d43c-4a32-8e11-1271b81dd9cb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2010-08-10T14:28:15.559999942&#x27;, &#x27;2010-08-10T14:28:16.319999933&#x27;,
       &#x27;2010-08-10T14:28:17.069999933&#x27;, ...,
       &#x27;2010-08-10T14:39:42.710000038&#x27;, &#x27;2010-08-10T14:39:43.500000000&#x27;,
       &#x27;2010-08-10T14:39:44.279999971&#x27;], dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>beam2inst_orientmat</span></div><div class='xr-var-dims'>(x, x*)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>1.462 -1.462 0.0 ... -1.034 -1.034</div><input id='attrs-66b1762e-c506-4b36-ad33-786e35f3ad9e' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-66b1762e-c506-4b36-ad33-786e35f3ad9e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b6d4e84b-690e-419b-800e-89db74e20c63' class='xr-var-data-in' type='checkbox'><label for='data-b6d4e84b-690e-419b-800e-89db74e20c63' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ 1.4619022 , -1.4619022 ,  0.        ,  0.        ],
       [ 0.        ,  0.        , -1.4619022 ,  1.4619022 ],
       [ 0.26604444,  0.26604444,  0.26604444,  0.26604444],
       [ 1.03372096,  1.03372096, -1.03372096, -1.03372096]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>orientmat</span></div><div class='xr-var-dims'>(earth, inst, time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-0.9037 -0.9025 -0.9064 ... 1.0 1.0</div><input id='attrs-11c2bb0b-3688-433e-9a95-2d893bbc194f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-11c2bb0b-3688-433e-9a95-2d893bbc194f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e9598538-b0ea-4f8e-b716-b74ede2f12b8' class='xr-var-data-in' type='checkbox'><label for='data-e9598538-b0ea-4f8e-b716-b74ede2f12b8' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[-0.90370917, -0.90251011, -0.90638149, ..., -0.95584428,
         -0.95936322, -0.95645773],
        [-0.42814681, -0.43066862, -0.42246014, ..., -0.29387355,
         -0.28217408, -0.29187089],
        [-0.        , -0.        , -0.        , ..., -0.        ,
         -0.        , -0.        ]],

       [[ 0.42814681,  0.43066862,  0.42246014, ...,  0.29387355,
          0.28217408,  0.29187089],
        [-0.90370917, -0.90251011, -0.90638149, ..., -0.95584428,
         -0.95936322, -0.95645773],
        [ 0.        ,  0.        ,  0.        , ...,  0.        ,
          0.        ,  0.        ]],

       [[-0.        , -0.        , -0.        , ..., -0.        ,
         -0.        , -0.        ],
        [ 0.        ,  0.        ,  0.        , ...,  0.        ,
          0.        ,  0.        ],
        [ 1.        ,  1.        ,  1.        , ...,  1.        ,
          1.        ,  1.        ]]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-be89ae6a-3e9a-4c35-9374-ac6a9f049c73' class='xr-section-summary-in' type='checkbox'  ><label for='section-be89ae6a-3e9a-4c35-9374-ac6a9f049c73' class='xr-section-summary' >Attributes: <span>(38)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>inst_make :</span></dt><dd>TRDI</dd><dt><span>inst_type :</span></dt><dd>ADCP</dd><dt><span>rotate_vars :</span></dt><dd>[&#x27;vel&#x27;, &#x27;vel_bt&#x27;]</dd><dt><span>has_imu :</span></dt><dd>0</dd><dt><span>prog_ver :</span></dt><dd>10.16</dd><dt><span>inst_model :</span></dt><dd>Rio Grande</dd><dt><span>beam_angle :</span></dt><dd>20</dd><dt><span>freq :</span></dt><dd>1200</dd><dt><span>beam_pattern :</span></dt><dd>convex</dd><dt><span>orientation :</span></dt><dd>down</dd><dt><span>n_beams :</span></dt><dd>4</dd><dt><span>n_cells :</span></dt><dd>47</dd><dt><span>pings_per_ensemble :</span></dt><dd>1</dd><dt><span>cell_size :</span></dt><dd>0.25</dd><dt><span>blank_dist :</span></dt><dd>0.25</dd><dt><span>profiling_mode :</span></dt><dd>12</dd><dt><span>min_corr_threshold :</span></dt><dd>64</dd><dt><span>n_code_reps :</span></dt><dd>4</dd><dt><span>min_prcnt_gd :</span></dt><dd>0</dd><dt><span>max_error_vel :</span></dt><dd>1.5</dd><dt><span>sec_between_ping_groups :</span></dt><dd>0.09</dd><dt><span>coord_sys :</span></dt><dd>ship</dd><dt><span>use_pitchroll :</span></dt><dd>yes</dd><dt><span>use_3beam :</span></dt><dd>yes</dd><dt><span>bin_mapping :</span></dt><dd>yes</dd><dt><span>heading_misalign_deg :</span></dt><dd>0.0</dd><dt><span>magnetic_var_deg :</span></dt><dd>0.0</dd><dt><span>sensors_src :</span></dt><dd>01011101</dd><dt><span>sensors_avail :</span></dt><dd>00011101</dd><dt><span>bin1_dist_m :</span></dt><dd>0.57</dd><dt><span>transmit_pulse_m :</span></dt><dd>0.3</dd><dt><span>water_ref_cells :</span></dt><dd>[0, 5]</dd><dt><span>false_target_threshold :</span></dt><dd>50</dd><dt><span>transmit_lag_m :</span></dt><dd>0.08</dd><dt><span>bandwidth :</span></dt><dd>0</dd><dt><span>sourceprog :</span></dt><dd>WINRIVER</dd><dt><span>fs :</span></dt><dd>11.11111111111111</dd><dt><span>vel_gps_corrected :</span></dt><dd>0</dd></dl></div></li></ul></div></div></div>
</div>
</section>
<section id="ADCP:-Convert-the-Coordinate-System-to-UTM">
<h3>ADCP: Convert the Coordinate System to UTM<a class="headerlink" href="#ADCP:-Convert-the-Coordinate-System-to-UTM" title="Link to this heading"></a></h3>
<p>By default, the ADCP coordinates are stored as latitude and longitude coordinates. However, latitude and longitude cannot be directly converted to a distance therefor here we convert from latitude and longitude to <span class="math notranslate nohighlight">\(UTM_x\)</span> and <span class="math notranslate nohighlight">\(UTM_y\)</span>. This gives us the ability to calculate the linear line of best fit for the idealized transect.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert Coordiantes to UTM using utm module</span>
<span class="n">utm_x_y</span> <span class="o">=</span> <span class="n">utm</span><span class="o">.</span><span class="n">from_latlon</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">latitude_gps</span><span class="p">,</span> <span class="n">transect_1_2</span><span class="o">.</span><span class="n">longitude_gps</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span><span class="p">)</span>

<span class="c1"># Create a DataFrame from the points</span>
<span class="n">gps</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">utm_x_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">utm_x_y</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="n">gps_points</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gps</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</section>
<section id="ADCP:-Declination">
<h3>ADCP: Declination<a class="headerlink" href="#ADCP:-Declination" title="Link to this heading"></a></h3>
<p>The magnetic declination cause data to be rotated slightly this can be corrected using MHKiT DOLfYN’s rotate api <code class="docutils literal notranslate"><span class="pre">set_declination</span></code>. If magnetic declination has already been accounted for with the deployment software, it will be saved under the attributes <code class="docutils literal notranslate"><span class="pre">magnetic_var_deg</span></code> for Teledyne instruments. The variable <code class="docutils literal notranslate"><span class="pre">magnetic_var_deg</span></code> is unaltered by the function <code class="docutils literal notranslate"><span class="pre">set_declination</span></code> as it creates a new variable (<code class="docutils literal notranslate"><span class="pre">declination</span></code>).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Nenana Alaska is 15.7 deg East</span>
<span class="n">angle</span> <span class="o">=</span> <span class="mf">15.7</span>
<span class="n">ap</span><span class="o">.</span><span class="n">set_declination</span><span class="p">(</span><span class="n">transect_1_2</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="ADCP:-Rotation-of-Data-Coordinate-System">
<h3>ADCP: Rotation of Data Coordinate System<a class="headerlink" href="#ADCP:-Rotation-of-Data-Coordinate-System" title="Link to this heading"></a></h3>
<p>Based on the deployment setting the coordinate system is set to “beam”,”inst”,”earth”, or “principal”. Using the <code class="docutils literal notranslate"><span class="pre">rotate2</span></code> function the coordinate system can by changed to fit the needs of the analysis. The <code class="docutils literal notranslate"><span class="pre">inplace</span></code> set as true will alter the input dataset “in place”, eg. it does not create a new dataset. This is further explained in the river_example ipython notebook.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rotate to &#39;earth&#39; coordinate system</span>
<span class="n">api</span><span class="o">.</span><span class="n">rotate2</span><span class="p">(</span><span class="n">transect_1_2</span><span class="p">,</span> <span class="s2">&quot;earth&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="ADCP:-Ideal-Transect">
<h3>ADCP: Ideal Transect<a class="headerlink" href="#ADCP:-Ideal-Transect" title="Link to this heading"></a></h3>
<p>To perform a Delft3D transect comparison with the ADCP data an “ideal transect”, defined as a straight path perpendicular to the flow that the boat was aiming for, was processed from the ADCP field data. Using the combined <code class="docutils literal notranslate"><span class="pre">transect_1_2</span></code> dataset a first degree numpy polyfit function (linear regression) was used to find a slope and intercept. Using the equation we can calculate <span class="math notranslate nohighlight">\(UTM_y\)</span> coordinates to create an ideal linear transect. The resultant ideal transect is shown in the figure
below.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Linear regression using first order polyfit</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">gps_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="n">gps_points</span><span class="o">.</span><span class="n">utm_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Generate a DataFrame of points from the linear regression</span>
<span class="n">ideal</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">gps_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="n">a</span> <span class="o">*</span> <span class="n">gps_points</span><span class="o">.</span><span class="n">utm_x</span> <span class="o">+</span> <span class="n">b</span><span class="p">)]</span>
<span class="n">ideal_points</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ideal</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">])</span>

<span class="c1"># Repeat UTM corrdinates to match the ADCP points matrix (dir, range, time)</span>
<span class="n">utm_x_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">gps_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">range</span><span class="p">))</span>
<span class="n">utm_y_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">gps_points</span><span class="o">.</span><span class="n">utm_x</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">range</span><span class="p">))</span>
<span class="n">depth_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">range</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">gps_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">))</span>

<span class="n">ADCP_ideal_points</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;utm_x&quot;</span><span class="p">:</span> <span class="n">utm_x_points</span><span class="p">,</span>
    <span class="s2">&quot;utm_y&quot;</span><span class="p">:</span> <span class="n">utm_y_points</span><span class="p">,</span>
    <span class="s2">&quot;waterdepth&quot;</span><span class="p">:</span> <span class="n">depth_points</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">ADCP_ideal_points</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ADCP_ideal_points</span><span class="p">)</span>

<span class="c1"># Initialize the figure</span>
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># Get data from the original transect in UTM for comparison</span>
<span class="n">transect_1</span> <span class="o">=</span> <span class="n">utm</span><span class="o">.</span><span class="n">from_latlon</span><span class="p">(</span>
    <span class="n">transect_1_raw</span><span class="o">.</span><span class="n">latitude_gps</span><span class="p">,</span> <span class="n">transect_1_raw</span><span class="o">.</span><span class="n">longitude_gps</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span>
<span class="p">)</span>
<span class="n">transect_2</span> <span class="o">=</span> <span class="n">utm</span><span class="o">.</span><span class="n">from_latlon</span><span class="p">(</span>
    <span class="n">transect_2_raw</span><span class="o">.</span><span class="n">latitude_gps</span><span class="p">,</span> <span class="n">transect_2_raw</span><span class="o">.</span><span class="n">longitude_gps</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;W&quot;</span>
<span class="p">)</span>

<span class="c1"># Plot the original transect data for comparison</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">transect_1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transect_1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GPS Transect 1&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">transect_2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">transect_2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;r--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;GPS Transect 2&quot;</span><span class="p">)</span>

<span class="c1"># Plot the Idealized Transect</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ADCP_ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="n">ADCP_ideal_points</span><span class="o">.</span><span class="n">utm_y</span><span class="p">,</span> <span class="s2">&quot;k-.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ideal Transect&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ticklabel_format</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;scientific&quot;</span><span class="p">,</span> <span class="n">useOffset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Plot Settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$UTM_x (m)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$UTM_y (m)$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$UTM_y (m)$&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;Figure size 800x600 with 0 Axes&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_12_2.png" src="_images/ADCP_Delft3D_TRTS_example_12_2.png" />
</div>
</div>
</section>
<section id="ADCP:-Range-Offset">
<h3>ADCP: Range Offset<a class="headerlink" href="#ADCP:-Range-Offset" title="Link to this heading"></a></h3>
<p>Depending on where the ADCP is deployed the <code class="docutils literal notranslate"><span class="pre">range</span></code> values might need to be offset by the deployment depth. For the TRTS dataset used here the range was corrected during the deployment setup, therefore, a zero-input used. This step is provided as a reference for other users.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Adjust the range offset, included here for reference</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">api</span><span class="o">.</span><span class="n">clean</span><span class="o">.</span><span class="n">set_range_offset</span><span class="p">(</span><span class="n">transect_1_2</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="ADCP:-Correlation-Filter">
<h3>ADCP: Correlation Filter<a class="headerlink" href="#ADCP:-Correlation-Filter" title="Link to this heading"></a></h3>
<p>Correlation is a measure of data quality, and its output is scaled in units such that the expected correlation (given high signal/noise ratio, S/N) is 128. Here data was fileted for a minimum correlation of 40 counts. [<a class="reference external" href="https://www.comm-tec.com/Docs/Manuali/RDI/BBPRIME.pdf">https://www.comm-tec.com/Docs/Manuali/RDI/BBPRIME.pdf</a>]</p>
<p>Looking at the plot in the figure below the ADCP is facing downward from the surface of the river and is defined as a range of 0. This means the top of the river is at the bottom of the plot. This ADCP has 4 beams the plot shown is one the 4 beams. From the plot of one of the beams shown below we can see that some of the values below the river bottom are filtered out.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply the correlation filter</span>
<span class="n">min_correlation</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">transect_1_2</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">clean</span><span class="o">.</span><span class="n">correlation_filter</span><span class="p">(</span><span class="n">transect_1_2</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="n">min_correlation</span><span class="p">)</span>

<span class="c1"># Plot the results the (data is displayed upside-down)</span>
<span class="n">transect_1_2</span><span class="o">.</span><span class="n">corr</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">beam</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.collections.QuadMesh at 0x2b9049a2a60&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_16_1.png" src="_images/ADCP_Delft3D_TRTS_example_16_1.png" />
</div>
</div>
</section>
<section id="ADCP:-River-Bottom-Filter">
<h3>ADCP: River Bottom Filter<a class="headerlink" href="#ADCP:-River-Bottom-Filter" title="Link to this heading"></a></h3>
<p>MHKiT DOLfYN has the functionality to find the river bottom based on the along-beam acoustic amplitude data recorded from the ADCP. However, if depth sounder data is available it can be more reliable at representing the river bottom. Here we use the depth sounder (<code class="docutils literal notranslate"><span class="pre">depth_sounder</span></code>) to create an array that can be used as a filter when multiplied with the velocity data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filtering out depth sounder values above the river surface</span>
<span class="n">depth_sounder</span> <span class="o">=</span> <span class="n">transect_1_2</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">dist_bt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Of the 4 values beams get the shallowest depth value at each location</span>
<span class="n">bottom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">depth_sounder</span><span class="o">.</span><span class="n">dist_bt</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># River bottom for ideal transect</span>
<span class="n">bottom_avg</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span><span class="n">gps_points</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">ideal_points</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>

<span class="c1"># Create a matrix of depths</span>
<span class="n">bottom_filter</span> <span class="o">=</span> <span class="n">d3d</span><span class="o">.</span><span class="n">create_points</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">bottom_avg</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">waterdepth</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Creating a mask matrix with ones in the area of the river cross section and nan&#39;s outside</span>
<span class="n">river_bottom_filter</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">bottom_filter</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]:</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
    <span class="n">river_bottom_filter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">river_bottom_filter</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 1, 2]
</pre></div></div>
</div>
</section>
<section id="ADCP:-Get-Original-Transect-Data">
<h3>ADCP: Get Original Transect Data<a class="headerlink" href="#ADCP:-Get-Original-Transect-Data" title="Link to this heading"></a></h3>
<p>Here we create a DataFrame of the original velocity components from the transect data. This DataFrame will be used to interpolate the velocity data onto the ideal transect.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tiling the GPS data for each depth bin</span>
<span class="n">gps_utm_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">gps_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">range</span><span class="p">))</span>
<span class="n">gps_utm_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">gps_points</span><span class="o">.</span><span class="n">utm_y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">range</span><span class="p">))</span>

<span class="c1"># Repeating the depth bins for each GPS point</span>
<span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">range</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">gps_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">))</span>

<span class="c1"># Create Dataframe from the calculated points</span>
<span class="n">ADCP_points</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;utm_x&quot;</span><span class="p">:</span> <span class="n">gps_utm_x</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">:</span> <span class="n">gps_utm_y</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">:</span> <span class="n">depth</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Raveling the veocity data to correspond with &#39;ADCP_points&#39; and filtering out velocity data bellow the river bottom</span>
<span class="n">ADCP_points</span><span class="p">[</span><span class="s2">&quot;east_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">river_bottom_filter</span>
<span class="n">ADCP_points</span><span class="p">[</span><span class="s2">&quot;north_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">river_bottom_filter</span>
<span class="p">)</span>
<span class="n">ADCP_points</span><span class="p">[</span><span class="s2">&quot;vertical_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">transect_1_2</span><span class="o">.</span><span class="n">vel</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span> <span class="o">*</span> <span class="n">river_bottom_filter</span>
<span class="p">)</span>
<span class="n">ADCP_points</span> <span class="o">=</span> <span class="n">ADCP_points</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Show points</span>
<span class="n">ADCP_points</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>utm_x</th>
      <th>utm_y</th>
      <th>waterdepth</th>
      <th>east_velocity</th>
      <th>north_velocity</th>
      <th>vertical_velocity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>400953.813014</td>
      <td>7.161133e+06</td>
      <td>0.57</td>
      <td>-0.094245</td>
      <td>0.214233</td>
      <td>-0.010</td>
    </tr>
    <tr>
      <th>1</th>
      <td>400953.813014</td>
      <td>7.161133e+06</td>
      <td>0.57</td>
      <td>0.181185</td>
      <td>0.079026</td>
      <td>0.022</td>
    </tr>
    <tr>
      <th>2</th>
      <td>400953.813014</td>
      <td>7.161133e+06</td>
      <td>0.57</td>
      <td>-0.143789</td>
      <td>0.129486</td>
      <td>-0.119</td>
    </tr>
    <tr>
      <th>3</th>
      <td>400953.813014</td>
      <td>7.161133e+06</td>
      <td>0.57</td>
      <td>-0.432847</td>
      <td>0.519561</td>
      <td>-0.095</td>
    </tr>
    <tr>
      <th>4</th>
      <td>400953.813014</td>
      <td>7.161133e+06</td>
      <td>0.57</td>
      <td>-0.258352</td>
      <td>0.393507</td>
      <td>-0.106</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>36171</th>
      <td>400989.066656</td>
      <td>7.161150e+06</td>
      <td>8.07</td>
      <td>0.074346</td>
      <td>1.819609</td>
      <td>0.084</td>
    </tr>
    <tr>
      <th>37323</th>
      <td>400993.746501</td>
      <td>7.161153e+06</td>
      <td>8.32</td>
      <td>0.409135</td>
      <td>0.774590</td>
      <td>0.055</td>
    </tr>
    <tr>
      <th>37324</th>
      <td>400993.746501</td>
      <td>7.161153e+06</td>
      <td>8.32</td>
      <td>0.230414</td>
      <td>0.237873</td>
      <td>0.038</td>
    </tr>
    <tr>
      <th>37328</th>
      <td>400992.412805</td>
      <td>7.161152e+06</td>
      <td>8.32</td>
      <td>0.381595</td>
      <td>0.560519</td>
      <td>0.104</td>
    </tr>
    <tr>
      <th>37331</th>
      <td>400991.734048</td>
      <td>7.161151e+06</td>
      <td>8.32</td>
      <td>0.058718</td>
      <td>0.515059</td>
      <td>0.152</td>
    </tr>
  </tbody>
</table>
<p>21850 rows × 6 columns</p>
</div></div>
</div>
</section>
<section id="ADCP:-Interpolating-Velocities-for-Ideal-Transect">
<h3>ADCP: Interpolating Velocities for Ideal Transect<a class="headerlink" href="#ADCP:-Interpolating-Velocities-for-Ideal-Transect" title="Link to this heading"></a></h3>
<p>Using the original transect data saved in <code class="docutils literal notranslate"><span class="pre">ADCP_points</span></code> the velocity values are interpolated onto the ideal transect points using the scipy interpolate <code class="docutils literal notranslate"><span class="pre">griddata</span></code> function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Project velocity onto ideal tansect</span>
<span class="n">ADCP_ideal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">ADCP_ideal</span><span class="p">[</span><span class="s2">&quot;east_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span>
    <span class="n">ADCP_points</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">ADCP_points</span><span class="p">[</span><span class="s2">&quot;east_velocity&quot;</span><span class="p">],</span>
    <span class="n">ADCP_ideal_points</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ADCP_ideal</span><span class="p">[</span><span class="s2">&quot;north_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span>
    <span class="n">ADCP_points</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">ADCP_points</span><span class="p">[</span><span class="s2">&quot;north_velocity&quot;</span><span class="p">],</span>
    <span class="n">ADCP_ideal_points</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ADCP_ideal</span><span class="p">[</span><span class="s2">&quot;vertical_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span>
    <span class="n">ADCP_points</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">ADCP_points</span><span class="p">[</span><span class="s2">&quot;vertical_velocity&quot;</span><span class="p">],</span>
    <span class="n">ADCP_ideal_points</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Calculate the magnitude of the velocity components</span>
<span class="n">ADCP_ideal</span><span class="p">[</span><span class="s2">&quot;magnitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
    <span class="n">ADCP_ideal</span><span class="o">.</span><span class="n">east_velocity</span><span class="o">**</span><span class="mi">2</span>
    <span class="o">+</span> <span class="n">ADCP_ideal</span><span class="o">.</span><span class="n">north_velocity</span><span class="o">**</span><span class="mi">2</span>
    <span class="o">+</span> <span class="n">ADCP_ideal</span><span class="o">.</span><span class="n">vertical_velocity</span><span class="o">**</span><span class="mi">2</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Using the calculated magnitude of velocity from the ADCP we can create a contour plot of the velocity magnitude.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the contour color bar bounds</span>
<span class="n">min_plot</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">max_plot</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># The Contour of velocity magnitude from the ADCP transect data</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">))</span>

<span class="n">contour_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span>
    <span class="n">ADCP_ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span>
    <span class="o">-</span><span class="n">ADCP_ideal_points</span><span class="o">.</span><span class="n">waterdepth</span><span class="p">,</span>
    <span class="n">ADCP_ideal</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">*</span> <span class="n">river_bottom_filter</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">min_plot</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="n">max_plot</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$UTM_x (m)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Water Depth (m)&quot;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_plot</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;velocity [m/s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">8.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">400950</span><span class="p">,</span> <span class="mi">401090</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="o">-</span><span class="n">bottom_avg</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;river bottom&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([400940., 400960., 400980., 401000., 401020., 401040., 401060.,
        401080., 401100.]),
 [Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;)])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_24_1.png" src="_images/ADCP_Delft3D_TRTS_example_24_1.png" />
</div>
</div>
</section>
<section id="ADCP:-Ideal-Transect-Down-sampled">
<h3>ADCP: Ideal Transect Down-sampled<a class="headerlink" href="#ADCP:-Ideal-Transect-Down-sampled" title="Link to this heading"></a></h3>
<p>Numerical models such as Delft3D use discretized points to represent the domain. Environmental models tend to have a low number of points to represent large continuous areas. For instance, the bird’s eye view of Delft3D only calculated numerical effects at a roughly 5m by 5m square. Delft3D then discretizes the depth with an even percentage from the water level to the bed by 12 layers as specified for this initial case. As the collected ADCP data had far more resolution than the numerical model
a down-sampling was applied using an average to match the locations at which the Delft3D model returned data. This roughly equated to ten velocity measurements spanning the width of the river and 12 measurments spanning the depth.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interpolate points by getting min &amp; max first</span>
<span class="n">start_utmx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ADCP_ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">)</span>
<span class="n">start_utmy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ADCP_ideal_points</span><span class="o">.</span><span class="n">utm_y</span><span class="p">)</span>

<span class="n">end_utmx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ADCP_ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">)</span>
<span class="n">end_utmy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ADCP_ideal_points</span><span class="o">.</span><span class="n">utm_y</span><span class="p">)</span>

<span class="c1"># Using N points for x calculate the y values on an ideal transect from the linear regression used earlier</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">utm_x_ideal_downsampeled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start_utmx</span><span class="p">,</span> <span class="n">end_utmx</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">utm_y_ideal_downsampeled</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">utm_x_ideal_downsampeled</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span>


<span class="c1"># Plot the Idealized Transect for comparison</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ADCP_ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="n">ADCP_ideal_points</span><span class="o">.</span><span class="n">utm_y</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ideal Transect&quot;</span>
<span class="p">)</span>

<span class="c1"># Plot the downsampled transect</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">utm_x_ideal_downsampeled</span><span class="p">,</span>
    <span class="n">utm_y_ideal_downsampeled</span><span class="p">,</span>
    <span class="s2">&quot;ro&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Down Sampled Ideal Transect&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># Plot settings</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$UTM_x$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$UTM_y$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;matplotlib.legend.Legend at 0x2b9225387c0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_26_1.png" src="_images/ADCP_Delft3D_TRTS_example_26_1.png" />
</div>
</div>
<p>With our down-sampled x,y points we can now create a down-sampled z at our x,y locations. As shown in the figure red dots below the river bottom will be excluded from the interpolation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create an idealized depth N layers deep</span>
<span class="n">N_layers</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">downsampled_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">transect_1_2</span><span class="o">.</span><span class="n">range</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">bottom_avg</span><span class="p">),</span> <span class="n">N_layers</span>
<span class="p">)</span>

<span class="c1"># Repeat this over the N points of the DownSampled Ideal Transect above</span>
<span class="n">depth_ideal_points_downsampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">downsampled_depth</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="c1"># Tile the x, y over the N of layers to add to a DataFrame</span>
<span class="n">utm_x_ideal_points_downsampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">utm_x_ideal_downsampeled</span><span class="p">,</span> <span class="n">N_layers</span><span class="p">)</span>
<span class="n">utm_y_ideal_points_downsampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">utm_y_ideal_downsampeled</span><span class="p">,</span> <span class="n">N_layers</span><span class="p">)</span>

<span class="c1"># Create a Dataframe of our idealized x,y,depth points</span>
<span class="n">ADCP_ideal_points_downsamples</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;utm_x&quot;</span><span class="p">:</span> <span class="n">utm_x_ideal_points_downsampled</span><span class="p">,</span>
        <span class="s2">&quot;utm_y&quot;</span><span class="p">:</span> <span class="n">utm_y_ideal_points_downsampled</span><span class="p">,</span>
        <span class="s2">&quot;waterdepth&quot;</span><span class="p">:</span> <span class="n">depth_ideal_points_downsampled</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Plot the Down sampled data points at the x locations</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ADCP_ideal_points_downsamples</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span>
    <span class="n">ADCP_ideal_points_downsamples</span><span class="o">.</span><span class="n">waterdepth</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;ro&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot the ADCP river bed</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="o">-</span><span class="n">bottom_avg</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;river bottom&quot;</span><span class="p">)</span>

<span class="c1"># Plot settings</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DownSampled Ideal Transect Depth&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$UTM_x [m]$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$ Depth [m]$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;$ Depth [m]$&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_28_1.png" src="_images/ADCP_Delft3D_TRTS_example_28_1.png" />
</div>
</div>
</section>
<section id="ADCP:-Interpolating-the-Downsampled-Velocites-for-the-Ideal-Transect">
<h3>ADCP: Interpolating the Downsampled Velocites for the Ideal Transect<a class="headerlink" href="#ADCP:-Interpolating-the-Downsampled-Velocites-for-the-Ideal-Transect" title="Link to this heading"></a></h3>
<p>The above process of creating a <code class="docutils literal notranslate"><span class="pre">river_bottom_filter</span></code> and interpolating onto the ideal transect is repeated for the down-sampled grid shown in the figure above. The depth sounder data is saved above in the variable <code class="docutils literal notranslate"><span class="pre">'bottom'</span></code> and used again here.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Project velocity onto ideal tansect</span>
<span class="n">ADCP_ideal_downsamples</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">ADCP_ideal_downsamples</span><span class="p">[</span><span class="s2">&quot;east_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span>
    <span class="n">ADCP_points</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">ADCP_points</span><span class="p">[</span><span class="s2">&quot;east_velocity&quot;</span><span class="p">],</span>
    <span class="n">ADCP_ideal_points_downsamples</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ADCP_ideal_downsamples</span><span class="p">[</span><span class="s2">&quot;north_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span>
    <span class="n">ADCP_points</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">ADCP_points</span><span class="p">[</span><span class="s2">&quot;north_velocity&quot;</span><span class="p">],</span>
    <span class="n">ADCP_ideal_points_downsamples</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ADCP_ideal_downsamples</span><span class="p">[</span><span class="s2">&quot;vertical_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span>
    <span class="n">ADCP_points</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">ADCP_points</span><span class="p">[</span><span class="s2">&quot;vertical_velocity&quot;</span><span class="p">],</span>
    <span class="n">ADCP_ideal_points_downsamples</span><span class="p">[[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">,</span> <span class="s2">&quot;waterdepth&quot;</span><span class="p">]],</span>
    <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ADCP_ideal_downsamples</span><span class="p">[</span><span class="s2">&quot;magnitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
    <span class="n">ADCP_ideal_downsamples</span><span class="o">.</span><span class="n">east_velocity</span><span class="o">**</span><span class="mi">2</span>
    <span class="o">+</span> <span class="n">ADCP_ideal_downsamples</span><span class="o">.</span><span class="n">north_velocity</span><span class="o">**</span><span class="mi">2</span>
    <span class="o">+</span> <span class="n">ADCP_ideal_downsamples</span><span class="o">.</span><span class="n">vertical_velocity</span><span class="o">**</span><span class="mi">2</span>
<span class="p">)</span>
<span class="n">ADCP_ideal_downsamples</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>east_velocity</th>
      <th>north_velocity</th>
      <th>vertical_velocity</th>
      <th>magnitude</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.300636</td>
      <td>1.421535</td>
      <td>0.042712</td>
      <td>1.453605</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.758431</td>
      <td>1.832806</td>
      <td>-0.016720</td>
      <td>1.983601</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.972110</td>
      <td>2.340159</td>
      <td>-0.043599</td>
      <td>2.534412</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-1.011364</td>
      <td>2.046775</td>
      <td>-0.034462</td>
      <td>2.283273</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>115</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>116</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>117</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>118</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>119</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>120 rows × 4 columns</p>
</div></div>
</div>
</section>
<section id="ADCP:-Plot-Down-Sampled-Ideal-Transect">
<h3>ADCP: Plot Down-Sampled Ideal Transect<a class="headerlink" href="#ADCP:-Plot-Down-Sampled-Ideal-Transect" title="Link to this heading"></a></h3>
<p>To plot the contour of the ideal sample points we need to first create a mask to remove data outside of the river bottom because the ideal transect grid (shown as red dots in the figure above) includes points below the river bottom.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a DataFrame of downsampled points</span>
<span class="n">ideal_downsampeled</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">utm_x_ideal_downsampeled</span><span class="p">,</span> <span class="n">utm_y_ideal_downsampeled</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">ideal_points_downsampled</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ideal_downsampeled</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;utm_x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># River bottom for downsampled ideal transect</span>
<span class="n">bottom_avg_downsampled</span> <span class="o">=</span> <span class="n">interp</span><span class="o">.</span><span class="n">griddata</span><span class="p">(</span>
    <span class="n">gps_points</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">ideal_points_downsampled</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span>
<span class="p">)</span>

<span class="c1"># Create a matrix of depths</span>
<span class="n">bottom_filter_downsampled</span> <span class="o">=</span> <span class="n">d3d</span><span class="o">.</span><span class="n">create_points</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">bottom_avg_downsampled</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">downsampled_depth</span><span class="p">,</span> <span class="n">waterdepth</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Creating a mask matrix with ones in the area of the river cross section and nan&#39;s outside</span>
<span class="n">river_bottom_filter_downsampled</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">bottom_filter_downsampled</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]:</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
    <span class="n">river_bottom_filter_downsampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">river_bottom_filter_downsampled</span><span class="p">,</span> <span class="nb">filter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 1, 2]
</pre></div></div>
</div>
<p>Using our down-sampled velocity magnitude a contour plot is created. For comparison the river bottom from the original ideal transect is shown.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">))</span>
<span class="n">contour_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span>
    <span class="n">ADCP_ideal_points_downsamples</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span>
    <span class="o">-</span><span class="n">ADCP_ideal_points_downsamples</span><span class="o">.</span><span class="n">waterdepth</span><span class="p">,</span>
    <span class="n">ADCP_ideal_downsamples</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">*</span> <span class="n">river_bottom_filter_downsampled</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">min_plot</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="n">max_plot</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot river bottom for comparison</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="o">-</span><span class="n">bottom_avg</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;river bottom&quot;</span><span class="p">)</span>

<span class="c1"># Plot Settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$UTM_x$ (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Water Depth (m)&quot;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_plot</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Velocity [m/s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">8.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">400950</span><span class="p">,</span> <span class="mi">401090</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([400940., 400960., 400980., 401000., 401020., 401040., 401060.,
        401080., 401100.]),
 [Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;)])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_34_1.png" src="_images/ADCP_Delft3D_TRTS_example_34_1.png" />
</div>
</div>
<p>## 2. Delft3D Data</p>
<p>Typically researchers use a modeling tool such as Deflt3D which, relative to field deployments, can perform low-cost simulations where changes to the environment can be implemented and interpreted quickly. This allows researchers to narrow in on a limited design set for field investigation thereby increasing the efficiency of field deployments. To initiate the numerical model, a 2010 bathymetry survey taken by Terrasond under contract to the University of Alaska Fairbanks (UAF) was used to
represent the domain. This domain was discretized using the Delft3D built-in mesh generation tool, RGF grid, to roughly 5m x 5m unstructured squares from a bird’s eye view. Delft3D represents depth using shallow water equations with a sigma layer approach which distributes the layers between the specified bottom of the river and the water level. An initial 12 sigma layers were specified to compare to filed data for this study. The domain was simulated in Delft3D at a constant discharge of
:math:<a href="#id1"><span class="problematic" id="id2">`</span></a>1789</p>
<blockquote>
<div><p>m^{3}/s` and a <span class="math notranslate nohighlight">\(2.7 m\)</span> water level, as recorded by the USGS survey station for August <span class="math notranslate nohighlight">\(10^{th}\)</span> 2010. The simulation shown in the example is designed to match the experimental conditions of when the ADCP plotted above was collected. The Delft3D model takes inputs of water level, discharge, and the river bathymetry. The United States Geological Survey (USGS) has a data collection downstream of the TRTS (station:”15515500”). The water level and discharge are taken from the USGS data,</p>
</div></blockquote>
<p>and the bathymetry data was collected in is the summer of 2010. In this example we will show how to get data from the USGS station and then jump to analyzing the output from the Delft3D model.</p>
</section>
<section id="D3D:-USGS-Water-Level">
<h3>D3D: USGS Water Level<a class="headerlink" href="#D3D:-USGS-Water-Level" title="Link to this heading"></a></h3>
<p>The United States Geological Survey has a nearby survey station (#15515500) downstream of the TRTS which records discharge and water level. The MHKiT River module has the capability to request data from USGS survey stations as demonstrated in the river example. Using MHKiT’s river module the water level for the USGS station was collected for the same day as the ADCP data was collected. The USGS assigns a parameter number of ‘00065’ for water level or Gage height. The water level was averaged to
be roughly 2.7m. This number is directly input into the Delft3D model and isn’t used in this example notebook. Further examples of using the river module are shown in the <code class="docutils literal notranslate"><span class="pre">river_example</span></code>. Similar to the water level the discharge was found using the same MHKit river module except swapping out the parameter number for ‘00060’ to get the discharge data. The discharge was averaged to be 1789 <span class="math notranslate nohighlight">\(m^3/s\)</span>. This value was also directly input to the Delft3D model and isn’t used in this example
notebook.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use the requests method to obtain 1 day of instantneous gage height data</span>
<span class="n">water_level_USGS_data</span> <span class="o">=</span> <span class="n">river</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">usgs</span><span class="o">.</span><span class="n">request_usgs_data</span><span class="p">(</span>
    <span class="n">station</span><span class="o">=</span><span class="s2">&quot;15515500&quot;</span><span class="p">,</span>
    <span class="n">parameter</span><span class="o">=</span><span class="s2">&quot;00065&quot;</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2010-08-10&quot;</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2010-08-10&quot;</span><span class="p">,</span>
    <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;Instantaneous&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot data</span>
<span class="n">water_level_USGS_data</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="c1"># Plot Settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Gage Height (feet)&quot;</span><span class="p">)</span>

<span class="c1"># Use the requests method to obtain 1 day of instantneous discharge data</span>
<span class="n">discharge_USGS_data</span> <span class="o">=</span> <span class="n">river</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">usgs</span><span class="o">.</span><span class="n">request_usgs_data</span><span class="p">(</span>
    <span class="n">station</span><span class="o">=</span><span class="s2">&quot;15515500&quot;</span><span class="p">,</span>
    <span class="n">parameter</span><span class="o">=</span><span class="s2">&quot;00060&quot;</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2010-08-10&quot;</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2010-08-10&quot;</span><span class="p">,</span>
    <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;Instantaneous&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Print data</span>
<span class="n">discharge_USGS_data</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># Plot Settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Dischage ($f^3/s$)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data request URL:  https://waterservices.usgs.gov/nwis/iv/?format=json&amp;sites=15515500&amp;startDT=2010-08-10&amp;endDT=2010-08-10&amp;parameterCd=00065&amp;siteStatus=all
Data request URL:  https://waterservices.usgs.gov/nwis/iv/?format=json&amp;sites=15515500&amp;startDT=2010-08-10&amp;endDT=2010-08-10&amp;parameterCd=00060&amp;siteStatus=all
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0, 0.5, &#39;Dischage ($f^3/s$)&#39;)
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_37_2.png" src="_images/ADCP_Delft3D_TRTS_example_37_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_37_3.png" src="_images/ADCP_Delft3D_TRTS_example_37_3.png" />
</div>
</div>
</section>
<section id="D3D:-Importing-Delft3D-Data">
<h3>D3D: Importing Delft3D Data<a class="headerlink" href="#D3D:-Importing-Delft3D-Data" title="Link to this heading"></a></h3>
<p>Here we are importing the NetCDF data exported by the Delft3D simulation described in the Delft3D introduction.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the simulated data</span>
<span class="n">d3d_data</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="s2">&quot;data/river/ADCP_transect/tanana81010_final_map.nc&quot;</span><span class="p">)</span>

<span class="c1"># Get the ADCP sample points</span>
<span class="n">ADCP_ideal_points_downsamples_xy</span> <span class="o">=</span> <span class="n">ADCP_ideal_points_downsamples</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;utm_x&quot;</span><span class="p">:</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;utm_y&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="D3D:-Ideal-Transect-Data">
<h3>D3D: Ideal Transect Data<a class="headerlink" href="#D3D:-Ideal-Transect-Data" title="Link to this heading"></a></h3>
<p>Next, we get the velocity data at the same points as the down-sampled ideal ADCP data. In Delft3D velocity in the y direction is <code class="docutils literal notranslate"><span class="pre">ucy</span></code>, velocity in the x direction is <code class="docutils literal notranslate"><span class="pre">ucx</span></code> and velocity in the z direction is <code class="docutils literal notranslate"><span class="pre">ucz</span></code>. From these velocity components the velocity magnitude is calculated using the root mean squared formula.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Interpolate the Delft3D simulated data onto the the sample points</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ucy&quot;</span><span class="p">,</span> <span class="s2">&quot;ucx&quot;</span><span class="p">,</span> <span class="s2">&quot;ucz&quot;</span><span class="p">]</span>
<span class="n">D3D</span> <span class="o">=</span> <span class="n">d3d</span><span class="o">.</span><span class="n">variable_interpolation</span><span class="p">(</span>
    <span class="n">d3d_data</span><span class="p">,</span> <span class="n">variables</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="n">ADCP_ideal_points_downsamples_xy</span>
<span class="p">)</span>

<span class="c1"># Calculate the magnitude of the velocity</span>
<span class="n">D3D</span><span class="p">[</span><span class="s2">&quot;magnitude&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">D3D</span><span class="o">.</span><span class="n">ucy</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">D3D</span><span class="o">.</span><span class="n">ucx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">D3D</span><span class="o">.</span><span class="n">ucz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
points provided
</pre></div></div>
</div>
<p>Using our Delft3D velocity magnitude a contour plot is created. The results are plotted with the original ideal ADCP river bottom for reference.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Delft3D interpolated Data</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">))</span>
<span class="n">contour_plot</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span>
    <span class="n">D3D</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
    <span class="o">-</span><span class="n">D3D</span><span class="o">.</span><span class="n">waterdepth</span><span class="p">,</span>
    <span class="n">D3D</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">*</span> <span class="n">river_bottom_filter_downsampled</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">min_plot</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="n">max_plot</span><span class="p">,</span>
    <span class="c1"># shading=&#39;gouraud&#39;</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot the river bottom calculated frol ADCP for comparison</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="o">-</span><span class="n">bottom_avg</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;river bottom&quot;</span><span class="p">)</span>

<span class="c1"># Figure settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$UTM_x (m)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Water Depth (m)&quot;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_plot</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;velocity [m/s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">8.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">400960</span><span class="p">,</span> <span class="mi">401090</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([400960., 400980., 401000., 401020., 401040., 401060., 401080.,
        401100.]),
 [Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;)])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_43_1.png" src="_images/ADCP_Delft3D_TRTS_example_43_1.png" />
</div>
</div>
</section>
</section>
<section id="3.-Error-Calulations">
<h2>3. Error Calulations<a class="headerlink" href="#3.-Error-Calulations" title="Link to this heading"></a></h2>
<p>Data from Delft3D and the ADCP were now on an equivalent set of points in our data processing environment. For comparison the <span class="math notranslate nohighlight">\(L_1\)</span>, <span class="math notranslate nohighlight">\(L_2\)</span>, and <span class="math notranslate nohighlight">\(L_{\infty}\)</span> norms were calculated for the Delft3D transect, and the down-sampled ADCP data. The L1 norm is equal to the absolute value of the difference between modeled and measured velocities, Delft3D and ADCP, respectively, over the measured velocity. This gives a fraction that can be converted into the percent difference between
measured and modeled velocities. The mean absolute error (MAE) in is an average value of L1. The error calculation process was repeated to calculate the L2 norm which is commonly referred to as the mean squared error (MSE). <span class="math notranslate nohighlight">\(L_1\)</span>, <span class="math notranslate nohighlight">\(L_2\)</span>, and <span class="math notranslate nohighlight">\(L_{\infty}\)</span> are dimensionless.</p>
<section id="Error:-L1">
<h3>Error: L1<a class="headerlink" href="#Error:-L1" title="Link to this heading"></a></h3>
<p><span class="math notranslate nohighlight">\(L_1= \frac{|D3D-ADCP|}{ADCP}\)</span></p>
<p><span class="math notranslate nohighlight">\(L_1\)</span> is a dimensionless value equal to the difference between the modeled and measured value divided by the actual value. In this case the measured ADCP is considered to be the actual value.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># L1</span>
<span class="n">L1_Magnitude</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nb">abs</span><span class="p">(</span><span class="n">ADCP_ideal_downsamples</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">-</span> <span class="n">D3D</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">ADCP_ideal_downsamples</span><span class="o">.</span><span class="n">magnitude</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Similar to the <code class="docutils literal notranslate"><span class="pre">river_bottom_filter</span></code> this filter replaces extreme values (100%) values with ‘nan’ and is then combined with the <code class="docutils literal notranslate"><span class="pre">river_bottom_filter</span></code> to create <code class="docutils literal notranslate"><span class="pre">error_filter</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">river_bottom_edge_filter_downsampled</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">L1_Magnitude</span><span class="p">:</span>
    <span class="k">if</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">:</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">filter</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;nan&quot;</span><span class="p">)</span>
    <span class="n">river_bottom_edge_filter_downsampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">river_bottom_edge_filter_downsampled</span><span class="p">,</span> <span class="nb">filter</span>
    <span class="p">)</span>

<span class="n">error_filter</span> <span class="o">=</span> <span class="n">river_bottom_edge_filter_downsampled</span> <span class="o">*</span> <span class="n">river_bottom_filter_downsampled</span>
</pre></div>
</div>
</div>
<p>The mean absolute error (MAE) is the average <span class="math notranslate nohighlight">\(L_1\)</span> error over the transect area. The MAE is displayed with the fil contour plot of <span class="math notranslate nohighlight">\(L_1\)</span>. <span class="math notranslate nohighlight">\(N\)</span> is equation is equle to the number of points in the river cross-sectional area.</p>
<p><span class="math notranslate nohighlight">\(MAE= \frac{\sum{L_1}}{N}\)</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate and priont the Mean Absolute Error</span>
<span class="n">MAE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L1_Magnitude</span> <span class="o">*</span> <span class="n">error_filter</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">L1_Magnitude</span><span class="p">[</span><span class="n">L1_Magnitude</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">])</span>
<span class="n">MAE</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.27060519470174677
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the min and max error values</span>
<span class="n">max_plot_error</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">min_plot_error</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Plotting the L1 error</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">))</span>
<span class="n">contour_plot_L1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span>
    <span class="n">D3D</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
    <span class="o">-</span><span class="n">D3D</span><span class="o">.</span><span class="n">waterdepth</span><span class="p">,</span>
    <span class="n">L1_Magnitude</span> <span class="o">*</span> <span class="n">error_filter</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">min_plot_error</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="n">max_plot_error</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot the river bottom for comparison</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="o">-</span><span class="n">bottom_avg</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;river bottom&quot;</span><span class="p">)</span>

<span class="c1"># Plot settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">400960</span><span class="p">,</span> <span class="mi">401090</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">8.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;UTM x (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Water Depth (m)&quot;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_plot_L1</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;$L_1$ Velocity Error&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([400960., 400980., 401000., 401020., 401040., 401060., 401080.,
        401100.]),
 [Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;)])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_50_1.png" src="_images/ADCP_Delft3D_TRTS_example_50_1.png" />
</div>
</div>
</section>
<section id="Error:-L2">
<h3>Error: L2<a class="headerlink" href="#Error:-L2" title="Link to this heading"></a></h3>
<p><span class="math notranslate nohighlight">\(L_2=\left(\frac{D3D-ADCP}{ADCP}\right)^2\)</span></p>
<p><span class="math notranslate nohighlight">\(L_2\)</span> is similar to <span class="math notranslate nohighlight">\(L_1\)</span> except <span class="math notranslate nohighlight">\(L_2\)</span> squares the difference between the modeled and measured values.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># L2</span>
<span class="n">L2_Magnitude</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">ADCP_ideal_downsamples</span><span class="o">.</span><span class="n">magnitude</span> <span class="o">-</span> <span class="n">D3D</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
    <span class="o">/</span> <span class="n">ADCP_ideal_downsamples</span><span class="o">.</span><span class="n">magnitude</span>
<span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<p>The mean squared error (MSE) is the average of <span class="math notranslate nohighlight">\(L_2\)</span> error over the transect area. <span class="math notranslate nohighlight">\(N\)</span> is equation is equle to the number of points in the river cross-sectional area.</p>
<p><span class="math notranslate nohighlight">\(MSE= \frac{\sum{L_2}}{N}\)</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">L2_Magnitude</span> <span class="o">*</span> <span class="n">error_filter</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">L2_Magnitude</span><span class="p">[</span><span class="n">L2_Magnitude</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">])</span>
<span class="n">MSE</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.11117035854303553
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a contour plot of the error</span>
<span class="c1"># Plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">))</span>
<span class="n">contour_plot_L2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">tripcolor</span><span class="p">(</span>
    <span class="n">D3D</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
    <span class="o">-</span><span class="n">D3D</span><span class="o">.</span><span class="n">waterdepth</span><span class="p">,</span>
    <span class="n">L2_Magnitude</span> <span class="o">*</span> <span class="n">error_filter</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="n">min_plot_error</span><span class="p">,</span>
    <span class="n">vmax</span><span class="o">=</span><span class="n">max_plot_error</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot the river bottom for comparison</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ideal_points</span><span class="o">.</span><span class="n">utm_x</span><span class="p">,</span> <span class="o">-</span><span class="n">bottom_avg</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;river bottom&quot;</span><span class="p">)</span>

<span class="c1"># Plot settings</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">400960</span><span class="p">,</span> <span class="mi">401090</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">8.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;UTM x (m)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Water Depth (m)&quot;</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">contour_plot_L1</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;$L_2$ Velocity Error&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s2">&quot;,&quot;</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(array([400960., 400980., 401000., 401020., 401040., 401060., 401080.,
        401100.]),
 [Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;),
  Text(0, 0, &#39;&#39;)])
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/ADCP_Delft3D_TRTS_example_55_1.png" src="_images/ADCP_Delft3D_TRTS_example_55_1.png" />
</div>
</div>
</section>
<section id="Error:-L_\infty">
<h3>Error: <span class="math notranslate nohighlight">\(L_\infty\)</span><a class="headerlink" href="#Error:-L_\infty" title="Link to this heading"></a></h3>
<p><span class="math notranslate nohighlight">\(L_\infty = max(L_1)\)</span></p>
<p><span class="math notranslate nohighlight">\(L_\infty\)</span> is the maximum L1 error</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># L inf</span>
<span class="n">L_inf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">L1_Magnitude</span> <span class="o">*</span> <span class="n">error_filter</span><span class="p">)</span>
<span class="n">L_inf</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.8140245754383203
</pre></div></div>
</div>
</section>
</section>
<section id="4.-Discussion">
<h2>4. Discussion<a class="headerlink" href="#4.-Discussion" title="Link to this heading"></a></h2>
<p>A model verification using simulated data of TRTS was compared to field data collected in 2010 using MHKiT. This example showcased the functionality of the MHKiT river and DOLfYN modules using a real-world study. The findings demonstrated how MHKiT modules may be combined to analyze simulated data and collected field data in a simple and quick manner. Other transect plotting software run separately from data analysis software. MHKiT’s ability to process data from multiple common marine energy
sources will help ME practitioners reach unique and novel results quickly by eliminating much of the start-up processing scripts most analysts must perform and maintain today. Although this is a river example, this framework of analysing modeled data and comparing it to wave and tidal experimental data is possible as well.</p>
<p>The high error values found between the model and field data were expected for a first attempt on a coarse numerical model domain. The coarse model domain allows MHKiT to host the data in this repository for public use and replication of this study’s results. This example further allows users to swap in their own data and build on this working example. Using this template the TRTS Delft3D model may now be tuned and easily compared to the error metrics calculated to improve our Delft3D Tanana
River model. Looking forward, a primary focus of model improvement would be the resolution of the Delft3D model, especially on the TRTS section of the Tanana river. Improving the Delft3D model is of particular interest to the TRTS staff as it can be used to predict the impact of the wake of a CEC on the surrounding environment such as the river bottom before it’s deployed long-term. This can save time and funding when implementing CECs onto an electrical grid while also mitigating environmental
impact.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, National Renewable Energy Laboratory, Pacific Northwest National Laboratory, and Sandia National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164358105-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-164358105-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>