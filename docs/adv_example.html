<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reading ADV Data with MHKiT &mdash; MHKiT v0.4.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/mhkit.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> MHKiT
          </a>
              <div class="version">
                v0.4.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="qc.html">QC Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="wave.html">Wave Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="river.html">River Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="tidal.html">Tidal Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="power.html">Power Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="loads.html">Loads Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="dolfyn.html">DOLfYN Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">MHKiT-Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="matlab.html">MHKiT-MATLAB</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="webinars.html">Webinars</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="citeus.html">Cite Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Online Forum</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MHKiT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Reading ADV Data with MHKiT</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/adv_example.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Reading-ADV-Data-with-MHKiT">
<h1>Reading ADV Data with MHKiT<a class="headerlink" href="#Reading-ADV-Data-with-MHKiT" title="Permalink to this headline"></a></h1>
<p>The following example demonstrates a simple workflow for analyzing Acoustic Doppler Velocimetry (ADV) data using MHKiT. MHKiT has brought the DOLfYN codebase in as an MHKiT module for working with ADV and Acoustic Doppler Current Profiler (ADCP) data. The DOLfYN MHKiT module is transferring functionality in two parts. In phase 1 the basic IO and core functions of DOLfYN are brought in. These functions include reading instrument data and rotating thru coordinate systems. In phase 2 DOLfYN
analysis functions are brought in. As phase 2 is still in progress we will import the analysis tools from the <a class="reference external" href="https://github.com/lkilcher/dolfyn">DOLfYN</a> package.</p>
<p>A typical ADV data workflow is broken down into 1. Review the raw data - Check timestamps - Look at velocity data quality, particularly for spiking 2. Check for spurious datapoints and remove. Replace bad datapoints using interpolation if desired 3. Rotate the data into principal flow coordinates (streamwise, cross-stream, vertical) 4. Average the data into bins, or ensembles, of a set time length (normally 5 to 10 min) 5. Calculate turbulence statistics (turbulence intensity, TKE, Reynolds
stresses) of the measured flowfield</p>
<p>Start by importing the necessary DOLfYN tools:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mhkit</span> <span class="kn">import</span> <span class="n">dolfyn</span> <span class="k">as</span> <span class="n">dlfn</span>
<span class="kn">from</span> <span class="nn">mhkit.dolfyn.adv</span> <span class="kn">import</span> <span class="n">api</span>
</pre></div>
</div>
</div>
<div class="section" id="Read-Raw-Instrument-Data">
<h2>Read Raw Instrument Data<a class="headerlink" href="#Read-Raw-Instrument-Data" title="Permalink to this headline"></a></h2>
<p>DOLfYN currently only carries support for the Nortek Vector ADV. The example loaded here is a short clip of data from a test deployment to show DOLfN’s capabilities.</p>
<p>Start by reading in the raw datafile downloaded from the instrument. The <code class="docutils literal notranslate"><span class="pre">dlfn.read</span></code> function reads the raw file and dumps the information into an xarray Dataset, which contains three groups of variables:</p>
<ol class="arabic simple">
<li><p>Velocity, amplitude, and correlation of the Doppler velocimetry</p></li>
<li><p>Measurements of the instrument’s bearing and environment</p></li>
<li><p>Orientation matrices DOLfYN uses for rotating through coordinate frames.</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">dlfn</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;data/dolfyn/vector_data01.VEC&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Reading file data/dolfyn/vector_data01.VEC ...
 end of file at 3000000 bytes.
</pre></div></div>
</div>
<p>To see what’s in an xarray Dataset, simply type the dataset’s name. To access a particular variable in a dataset, use dict-style (<code class="docutils literal notranslate"><span class="pre">ds['vel']</span></code>) or attribute-style syntax (<code class="docutils literal notranslate"><span class="pre">ds.vel</span></code>). See the <a class="reference external" href="http://xarray.pydata.org/en/stable/getting-started-guide/quick-overview.html">xarray docs</a> for more details on how to use the xarray format.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># print the dataset</span>
<span class="n">ds</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:              (time: 122912, dir: 3, beam: 3, x*: 3, earth: 3, inst: 3)
Coordinates:
  * time                 (time) datetime64[ns] 2012-06-12T12:00:02.968749 ......
  * dir                  (dir) &lt;U1 &#x27;X&#x27; &#x27;Y&#x27; &#x27;Z&#x27;
  * beam                 (beam) int32 1 2 3
  * x*                   (x*) int32 1 2 3
  * earth                (earth) &lt;U1 &#x27;E&#x27; &#x27;N&#x27; &#x27;U&#x27;
  * inst                 (inst) &lt;U1 &#x27;X&#x27; &#x27;Y&#x27; &#x27;Z&#x27;
Data variables: (12/15)
    beam2inst_orientmat  (beam, x*) float64 2.709 -1.34 ... -0.3438 -0.3499
    batt                 (time) float32 13.2 13.2 13.2 13.2 ... nan nan nan nan
    c_sound              (time) float32 1.493e+03 1.493e+03 ... nan nan
    heading              (time) float32 5.6 10.5 10.51 10.52 ... nan nan nan nan
    pitch                (time) float32 -31.5 -31.7 -31.69 ... nan nan nan
    roll                 (time) float32 0.4 4.2 4.253 4.306 ... nan nan nan nan
    ...                   ...
    vel                  (dir, time) float32 -1.002 -1.008 -0.944 ... nan nan
    amp                  (dir, time) uint8 104 110 111 113 108 112 ... 0 0 0 0 0
    corr                 (dir, time) uint8 97 91 97 98 90 95 95 ... 0 0 0 0 0 0
    orientation_down     (time) bool True True True True ... True True True True
    pressure             (time) float64 5.448 5.436 5.484 5.448 ... 0.0 0.0 0.0
    orientmat            (earth, inst, time) float32 0.0832 0.155 ... -0.7065
Attributes:
    config:       {&#x27;ProLogID&#x27;: 149, &#x27;ProLogFWver&#x27;: &#x27;4.08&#x27;, &#x27;config&#x27;: 15412, &#x27;...
    inst_make:    Nortek
    inst_model:   Vector
    inst_type:    ADV
    rotate_vars:  [&#x27;vel&#x27;]
    freq:         6000
    SerialNum:    VEC 9062
    Comments:     APL-UW vector on Tidal Turbulence Mooring in Admiralty, tim...
    fs:           32.0
    coord_sys:    inst
    has_imu:      0</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-06f8b904-367c-40e1-a076-aa3368c31acd' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-06f8b904-367c-40e1-a076-aa3368c31acd' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 122912</li><li><span class='xr-has-index'>dir</span>: 3</li><li><span class='xr-has-index'>beam</span>: 3</li><li><span class='xr-has-index'>x*</span>: 3</li><li><span class='xr-has-index'>earth</span>: 3</li><li><span class='xr-has-index'>inst</span>: 3</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-0e463862-da03-4a8a-8b50-0ad48c72f51a' class='xr-section-summary-in' type='checkbox'  checked><label for='section-0e463862-da03-4a8a-8b50-0ad48c72f51a' class='xr-section-summary' >Coordinates: <span>(6)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2012-06-12T12:00:02.968749 ... 2...</div><input id='attrs-9f6a7f2d-fd0d-4a8b-ac50-a3bd5ad05bac' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-9f6a7f2d-fd0d-4a8b-ac50-a3bd5ad05bac' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-d1ccc045-a053-44bc-987a-908858ee1dd2' class='xr-var-data-in' type='checkbox'><label for='data-d1ccc045-a053-44bc-987a-908858ee1dd2' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;2012-06-12T12:00:02.968749000&#x27;, &#x27;2012-06-12T12:00:02.999999000&#x27;,
       &#x27;2012-06-12T12:00:03.031249000&#x27;, ..., &#x27;2012-06-12T13:04:03.875001000&#x27;,
       &#x27;2012-06-12T13:04:03.906251000&#x27;, &#x27;2012-06-12T13:04:03.937501000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>dir</span></div><div class='xr-var-dims'>(dir)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;X&#x27; &#x27;Y&#x27; &#x27;Z&#x27;</div><input id='attrs-a4d3198b-d7e5-499a-a621-48a34484698f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-a4d3198b-d7e5-499a-a621-48a34484698f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-63ea9ad1-94ef-424b-9048-138f1a2d0cdc' class='xr-var-data-in' type='checkbox'><label for='data-63ea9ad1-94ef-424b-9048-138f1a2d0cdc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>ref_frame :</span></dt><dd>inst</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>beam</span></div><div class='xr-var-dims'>(beam)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>1 2 3</div><input id='attrs-7244cb2a-bb67-4417-9775-b8f38b0fa1e4' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-7244cb2a-bb67-4417-9775-b8f38b0fa1e4' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b8801e25-bacf-4b98-a78d-41a3b05bdd94' class='xr-var-data-in' type='checkbox'><label for='data-b8801e25-bacf-4b98-a78d-41a3b05bdd94' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x*</span></div><div class='xr-var-dims'>(x*)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>1 2 3</div><input id='attrs-c8069d16-46f2-4e5c-bffe-ecccc7ec16e1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-c8069d16-46f2-4e5c-bffe-ecccc7ec16e1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-240ddfb9-0bac-43d3-9445-8720b841b140' class='xr-var-data-in' type='checkbox'><label for='data-240ddfb9-0bac-43d3-9445-8720b841b140' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2, 3])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>earth</span></div><div class='xr-var-dims'>(earth)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;E&#x27; &#x27;N&#x27; &#x27;U&#x27;</div><input id='attrs-f93f059a-6ab6-408b-be60-790c34bd9633' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-f93f059a-6ab6-408b-be60-790c34bd9633' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6691d4d4-e194-498f-8b87-c738319f56fc' class='xr-var-data-in' type='checkbox'><label for='data-6691d4d4-e194-498f-8b87-c738319f56fc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;E&#x27;, &#x27;N&#x27;, &#x27;U&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>inst</span></div><div class='xr-var-dims'>(inst)</div><div class='xr-var-dtype'>&lt;U1</div><div class='xr-var-preview xr-preview'>&#x27;X&#x27; &#x27;Y&#x27; &#x27;Z&#x27;</div><input id='attrs-e38ee2d9-56dc-4f4a-954a-898ac9a95814' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e38ee2d9-56dc-4f4a-954a-898ac9a95814' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dab527de-4960-4e51-902d-367b635b0fd4' class='xr-var-data-in' type='checkbox'><label for='data-dab527de-4960-4e51-902d-367b635b0fd4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([&#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;], dtype=&#x27;&lt;U1&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-7fe40547-84dd-4b49-b39b-cb0f97b2296d' class='xr-section-summary-in' type='checkbox'  ><label for='section-7fe40547-84dd-4b49-b39b-cb0f97b2296d' class='xr-section-summary' >Data variables: <span>(15)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>beam2inst_orientmat</span></div><div class='xr-var-dims'>(beam, x*)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>2.709 -1.34 ... -0.3438 -0.3499</div><input id='attrs-4f05bbb1-a5c0-4dbe-aa6b-7c81e3f1a7f1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4f05bbb1-a5c0-4dbe-aa6b-7c81e3f1a7f1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c7ae1d34-2b83-49f7-8f5f-f6c12f18911b' class='xr-var-data-in' type='checkbox'><label for='data-c7ae1d34-2b83-49f7-8f5f-f6c12f18911b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[ 2.70874023, -1.34008789, -1.36376953],
       [ 0.0144043 , -2.38354492,  2.39550781],
       [-0.3371582 , -0.34375   , -0.34985352]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>batt</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>13.2 13.2 13.2 13.2 ... nan nan nan</div><input id='attrs-0db7bc31-ea29-4a90-bb65-9c897c8c1661' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-0db7bc31-ea29-4a90-bb65-9c897c8c1661' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-872c111a-e883-4e05-a71f-af2c381af773' class='xr-var-data-in' type='checkbox'><label for='data-872c111a-e883-4e05-a71f-af2c381af773' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>V</dd></dl></div><div class='xr-var-data'><pre>array([13.2, 13.2, 13.2, ...,  nan,  nan,  nan], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>c_sound</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>1.493e+03 1.493e+03 ... nan nan</div><input id='attrs-8bf7d85c-c76e-4038-9108-f32ef45032e6' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-8bf7d85c-c76e-4038-9108-f32ef45032e6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-913203fe-54fa-4d63-8432-3c1435ba58a1' class='xr-var-data-in' type='checkbox'><label for='data-913203fe-54fa-4d63-8432-3c1435ba58a1' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m/s</dd></dl></div><div class='xr-var-data'><pre>array([1492.6, 1492.6, 1492.6, ...,    nan,    nan,    nan], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>heading</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>5.6 10.5 10.51 ... nan nan nan</div><input id='attrs-fad9ffb0-b387-44b2-8704-93a44763f11b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-fad9ffb0-b387-44b2-8704-93a44763f11b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bbd36a45-c8fb-4df8-8b47-c959e59a8257' class='xr-var-data-in' type='checkbox'><label for='data-bbd36a45-c8fb-4df8-8b47-c959e59a8257' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([ 5.6   , 10.5   , 10.5125, ...,     nan,     nan,     nan],
      dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>pitch</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-31.5 -31.7 -31.69 ... nan nan nan</div><input id='attrs-b93f8c8b-97b2-4de2-be7b-e62f74d49cb2' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-b93f8c8b-97b2-4de2-be7b-e62f74d49cb2' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-98d01a31-c1b9-4adf-b28c-c9ecae9e5c4d' class='xr-var-data-in' type='checkbox'><label for='data-98d01a31-c1b9-4adf-b28c-c9ecae9e5c4d' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([-31.5     , -31.7     , -31.690626, ...,        nan,        nan,
              nan], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>roll</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.4 4.2 4.253 4.306 ... nan nan nan</div><input id='attrs-d9b15a4d-90ef-470a-8c68-806984319e4a' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d9b15a4d-90ef-470a-8c68-806984319e4a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3a9f3b75-1cf1-47e7-8b58-41bfd73da29c' class='xr-var-data-in' type='checkbox'><label for='data-3a9f3b75-1cf1-47e7-8b58-41bfd73da29c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg</dd></dl></div><div class='xr-var-data'><pre>array([0.4      , 4.2000003, 4.253125 , ...,       nan,       nan,
             nan], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>temp</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>12.67 12.68 12.68 ... nan nan nan</div><input id='attrs-72d4010e-21d4-4a52-ba16-e2ef98619af6' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-72d4010e-21d4-4a52-ba16-e2ef98619af6' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9c1e0fae-d807-4b35-ba94-ff48955837dc' class='xr-var-data-in' type='checkbox'><label for='data-9c1e0fae-d807-4b35-ba94-ff48955837dc' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>deg C</dd></dl></div><div class='xr-var-data'><pre>array([12.67    , 12.679999, 12.679999, ...,       nan,       nan,
             nan], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>error</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>0 0 0 0 0 0 0 0 ... 0 0 0 0 0 0 0 0</div><input id='attrs-67d78aba-77be-4343-a900-1e9eb90d99e1' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-67d78aba-77be-4343-a900-1e9eb90d99e1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bf5ed39c-be17-4118-a21d-0332762c6113' class='xr-var-data-in' type='checkbox'><label for='data-bf5ed39c-be17-4118-a21d-0332762c6113' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd></dd></dl></div><div class='xr-var-data'><pre>array([0, 0, 0, ..., 0, 0, 0], dtype=uint8)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>status</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>117 117 0 0 0 0 0 ... 0 0 0 0 0 0 0</div><input id='attrs-27cf3332-65da-4f03-98b7-bf51cfb44b97' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-27cf3332-65da-4f03-98b7-bf51cfb44b97' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-790a8073-69e1-4fbf-9970-5c33abb3fbcd' class='xr-var-data-in' type='checkbox'><label for='data-790a8073-69e1-4fbf-9970-5c33abb3fbcd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd></dd></dl></div><div class='xr-var-data'><pre>array([117, 117,   0, ...,   0,   0,   0], dtype=uint8)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>vel</span></div><div class='xr-var-dims'>(dir, time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>-1.002 -1.008 -0.944 ... nan nan</div><input id='attrs-8164e135-a08c-4bc1-b037-ace91ee35867' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-8164e135-a08c-4bc1-b037-ace91ee35867' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-98b38d17-7478-4416-994d-19fe520da80b' class='xr-var-data-in' type='checkbox'><label for='data-98b38d17-7478-4416-994d-19fe520da80b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>m/s</dd></dl></div><div class='xr-var-data'><pre>array([[-1.0020001 , -1.008     , -0.94400007, ...,         nan,
                nan,         nan],
       [ 0.097     ,  0.068     ,  0.066     , ...,         nan,
                nan,         nan],
       [ 0.115     ,  0.12400001,  0.12200001, ...,         nan,
                nan,         nan]], dtype=float32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>amp</span></div><div class='xr-var-dims'>(dir, time)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>104 110 111 113 108 ... 0 0 0 0 0</div><input id='attrs-d11d4f49-0ec2-48b2-a8d0-ae491fb87ceb' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d11d4f49-0ec2-48b2-a8d0-ae491fb87ceb' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-96555852-14b6-4af1-ab7c-d40267f57847' class='xr-var-data-in' type='checkbox'><label for='data-96555852-14b6-4af1-ab7c-d40267f57847' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>dB</dd></dl></div><div class='xr-var-data'><pre>array([[104, 110, 111, ...,   0,   0,   0],
       [109, 111, 118, ...,   0,   0,   0],
       [111, 107, 103, ...,   0,   0,   0]], dtype=uint8)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>corr</span></div><div class='xr-var-dims'>(dir, time)</div><div class='xr-var-dtype'>uint8</div><div class='xr-var-preview xr-preview'>97 91 97 98 90 95 ... 0 0 0 0 0 0</div><input id='attrs-cc545443-17e7-4d61-b7dd-223dc9cb6b2c' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-cc545443-17e7-4d61-b7dd-223dc9cb6b2c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-a4a94887-0864-4e5c-841d-d4d87a09bf70' class='xr-var-data-in' type='checkbox'><label for='data-a4a94887-0864-4e5c-841d-d4d87a09bf70' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>%</dd></dl></div><div class='xr-var-data'><pre>array([[97, 91, 97, ...,  0,  0,  0],
       [97, 97, 98, ...,  0,  0,  0],
       [96, 97, 97, ...,  0,  0,  0]], dtype=uint8)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>orientation_down</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>bool</div><div class='xr-var-preview xr-preview'>True True True ... True True True</div><input id='attrs-cbbf9bd9-de9d-48a6-8a65-8a5412868689' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-cbbf9bd9-de9d-48a6-8a65-8a5412868689' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-3485ffd6-7adb-4489-85d0-d00fd66b80cb' class='xr-var-data-in' type='checkbox'><label for='data-3485ffd6-7adb-4489-85d0-d00fd66b80cb' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([ True,  True,  True, ...,  True,  True,  True])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>pressure</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>5.448 5.436 5.484 ... 0.0 0.0 0.0</div><input id='attrs-d243cdb6-22fa-437e-bd08-c875bf4d6a4f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-d243cdb6-22fa-437e-bd08-c875bf4d6a4f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-73492db5-1211-4b3d-829a-6be0f849c720' class='xr-var-data-in' type='checkbox'><label for='data-73492db5-1211-4b3d-829a-6be0f849c720' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>dbar</dd></dl></div><div class='xr-var-data'><pre>array([5.448, 5.436, 5.484, ..., 0.   , 0.   , 0.   ])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>orientmat</span></div><div class='xr-var-dims'>(earth, inst, time)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>0.0832 0.155 ... -0.7065 -0.7065</div><input id='attrs-2aff3efc-52e4-4429-9637-c24ed502ea9a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-2aff3efc-52e4-4429-9637-c24ed502ea9a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e748fefd-76c8-4f36-bf7a-8e6c1eee049c' class='xr-var-data-in' type='checkbox'><label for='data-e748fefd-76c8-4f36-bf7a-8e6c1eee049c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[[ 0.08320302,  0.15504801,  0.15524618, ..., -0.8397447 ,
         -0.8397447 , -0.8397447 ],
        [ 0.8485708 ,  0.83656424,  0.8366149 , ...,  0.21873687,
          0.21873687,  0.21873687],
        [-0.52249855, -0.5254717 , -0.52533245, ..., -0.49697396,
         -0.49697396, -0.49697396]],

       [[ 0.9948472 ,  0.97360104,  0.9733992 , ...,  0.4844887 ,
          0.4844887 ,  0.4844887 ],
        [-0.10121067, -0.21958628, -0.22025378, ...,  0.7150815 ,
          0.7150815 ,  0.7150815 ],
        [-0.00595242, -0.06231184, -0.06310494, ..., -0.50391394,
         -0.50391394, -0.50391394]],

       [[-0.05793348, -0.16751422, -0.16850099, ...,  0.24515232,
          0.24515232,  0.24515232],
        [-0.51931095, -0.50193846, -0.5015614 , ..., -0.6639373 ,
         -0.6639373 , -0.6639373 ],
        [-0.85261935, -0.84852624, -0.84855384, ..., -0.7064614 ,
         -0.7064614 , -0.7064614 ]]], dtype=float32)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-c769ae46-a5f1-491b-97e8-a114d6deda85' class='xr-section-summary-in' type='checkbox'  ><label for='section-c769ae46-a5f1-491b-97e8-a114d6deda85' class='xr-section-summary' >Attributes: <span>(11)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>config :</span></dt><dd>{&#x27;ProLogID&#x27;: 149, &#x27;ProLogFWver&#x27;: &#x27;4.08&#x27;, &#x27;config&#x27;: 15412, &#x27;freq&#x27;: 6000, &#x27;PICversion&#x27;: 0, &#x27;HWrevision&#x27;: 4, &#x27;recSize&#x27;: 4074766336, &#x27;status&#x27;: 20, &#x27;FWversion&#x27;: 875769395, &#x27;Transmit&#x27;: {&#x27;pulse_length&#x27;: 2, &#x27;blank_distance&#x27;: 16, &#x27;receive_length&#x27;: 7, &#x27;time_between_pings&#x27;: 44, &#x27;time_between_bursts&#x27;: 512}, &#x27;Npings&#x27;: 1, &#x27;AvgInterval&#x27;: 16, &#x27;NBeams&#x27;: 3, &#x27;TimCtrlReg&#x27;: array([False,  True, False, False, False, False, False,  True, False,
       False, False, False, False, False, False, False]), &#x27;Profile_Timing&#x27;: &#x27;continuous&#x27;, &#x27;Burst_Mode&#x27;: True, &#x27;Power Level&#x27;: 1, &#x27;sync-out&#x27;: &#x27;end&#x27;, &#x27;Sample_on_Sync&#x27;: False, &#x27;Start_on_Sync&#x27;: False, &#x27;PwrCtrlReg&#x27;: array([False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False]), &#x27;A1&#x27;: 0, &#x27;B0&#x27;: 0, &#x27;B1&#x27;: 0, &#x27;CompassUpdRate&#x27;: 1, &#x27;coord_sys_axes&#x27;: &#x27;XYZ&#x27;, &#x27;NBins&#x27;: 1, &#x27;BinLength&#x27;: 7, &#x27;MeasInterval&#x27;: 600, &#x27;DeployName&#x27;: &#x27;APLUW_&#x27;, &#x27;WrapMode&#x27;: 0, &#x27;ClockDeploy&#x27;: array([   0, 4626, 1554]), &#x27;DiagInterval&#x27;: 10800, &#x27;Mode0&#x27;: array([False, False, False, False, False, False, False, False, False,
       False, False, False, False, False, False, False]), &#x27;AdjSoundSpeed&#x27;: 16657, &#x27;NSampDiag&#x27;: 1, &#x27;NBeamsCellDiag&#x27;: 1, &#x27;NPingsDiag&#x27;: 20, &#x27;ModeTest&#x27;: array([False, False,  True, False, False, False, False, False, False,
       False, False, False, False, False, False, False]), &#x27;AnaInAddr&#x27;: 0, &#x27;SWVersion&#x27;: 13200, &#x27;VelAdjTable&#x27;: array([15542, 15570, 15597, 15625, 15651, 15678, 15704, 15730, 15755,
       15781, 15806, 15830, 15855, 15879, 15902, 15926, 15949, 15972,
       15995, 16017, 16039, 16061, 16083, 16104, 16125, 16146, 16166,
       16186, 16206, 16226, 16246, 16265, 16284, 16303, 16321, 16340,
       16358, 16376, 16393, 16411, 16428, 16445, 16462, 16478, 16494,
       16510, 16526, 16542, 16557, 16573, 16588, 16603, 16617, 16632,
       16646, 16660, 16674, 16687, 16701, 16714, 16727, 16740, 16753,
       16765, 16778, 16790, 16802, 16814, 16825, 16837, 16848, 16859,
       16870, 16881, 16891, 16902, 16912, 16922, 16932, 16941, 16951,
       16960, 16969, 16978, 16987, 16996, 17004, 17013, 17021, 17029]), &#x27;Mode1&#x27;: array([False, False, False,  True,  True,  True, False,  True,  True,
        True, False,  True, False, False, False, False]), &#x27;DynPercPos&#x27;: 32768, &#x27;T1w&#x27;: 16384, &#x27;T2w&#x27;: 32768, &#x27;T3w&#x27;: 16384, &#x27;NSamp&#x27;: 8192, &#x27;NBurst&#x27;: 0, &#x27;AnaOutScale&#x27;: 65535, &#x27;CorrThresh&#x27;: 0, &#x27;TiLag2&#x27;: 2, &#x27;QualConst&#x27;: array([65290, 65485,   139,   229,   238,    11, 65412, 65341]), &#x27;mode&#x27;: {&#x27;user_sound&#x27;: False, &#x27;diagnostics_mode&#x27;: False, &#x27;analog_output_mode&#x27;: False, &#x27;output_format&#x27;: &#x27;Vector&#x27;, &#x27;vel_scale&#x27;: 1, &#x27;serial_output&#x27;: False, &#x27;reserved_EasyQ&#x27;: False, &#x27;stage&#x27;: False, &#x27;output_power&#x27;: False, &#x27;mode_test_use_DSP&#x27;: False, &#x27;mode_test_filter_output&#x27;: &#x27;total&#x27;, &#x27;rate&#x27;: &#x27;1hz&#x27;, &#x27;cell_position&#x27;: &#x27;fixed&#x27;, &#x27;dynamic_pos_type&#x27;: &#x27;pct of mean press&#x27;}, &#x27;fs&#x27;: 32.0, &#x27;data_header&#x27;: {&#x27;time&#x27;: 1339502401.0, &#x27;NRecords&#x27;: 0, &#x27;Noise1&#x27;: 55, &#x27;Noise2&#x27;: 54, &#x27;Noise3&#x27;: 55, &#x27;Spare0&#x27;: &#x27;\x00&#x27;, &#x27;Corr1&#x27;: 6, &#x27;Corr2&#x27;: 7, &#x27;Corr3&#x27;: 7, &#x27;Spare1&#x27;: &#x27;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;}, &#x27;checkdata&#x27;: {&#x27;Samples&#x27;: 300, &#x27;First_samp&#x27;: 0, &#x27;Amp1&#x27;: array([202, 180, 153, 128, 106,  88,  74,  93,  87,  87,  84,  79,  72,
        68,  61,  58,  57,  60,  58,  58,  57,  57,  57,  56,  56,  56,
        55,  54,  54, 156, 135, 113,  94,  80,  71,  66,  63,  61,  60,
        61,  60,  60,  59,  58,  58,  59,  60,  60,  60,  61,  61,  62,
        62,  62,  62,  61,  61,  61,  62,  62,  63,  63,  63,  64,  64,
        64,  63,  63,  64,  64,  64,  64,  67,  67,  68,  69,  69,  70,
        71,  73,  74,  74,  75,  79,  84,  89,  91,  91,  92,  92,  92,
        94,  97, 100, 100, 100, 100,  98,  97,  96,  95,  96, 100, 101,
       100,  99,  97,  96,  94,  92,  89,  88,  87,  87,  87,  88,  85,
        82,  80,  77,  74,  72,  70,  69,  68,  68,  68,  67,  67,  65,
        64,  63,  62,  61,  62,  61,  60,  59,  59,  58,  60,  60,  59,
        58,  58,  58,  57,  57,  57,  58,  58,  57,  57,  57,  57,  58,
        59,  60,  58,  57,  57,  56,  56,  56,  56,  56,  57,  56,  56,
        56,  56,  56,  55,  55,  56,  56,  55,  55,  56,  56,  56,  55,
        56,  56,  56,  55,  55,  55,  56,  56,  55,  55,  56,  56,  55,
        55,  55,  55,  55,  55,  55,  56,  56,  56,  55,  55,  55,  55,
        55,  55,  55,  56,  56,  56,  57,  56,  56,  55,  56,  56,  57,
        57,  55,  55,  55,  55,  55,  55,  55,  55,  55,  56,  56,  56,
        56,  55,  56,  55,  56,  55,  56,  56,  56,  56,  56,  56,  56,
        55,  55,  55,  55,  55,  55,  55,  56,  55,  55,  55,  54,  54,
        55,  55,  55,  55,  54,  54,  55,  55,  56,  55,  56,  55,  55,
        55,  56,  54,  56,  56,  55,  56,  56,  55,  55,  55,  55,  56,
        55,  55,  56,  55,  55,  55,  55,  55,  55,  55,  55,  55,  55,
        55], dtype=uint8), &#x27;Amp2&#x27;: array([202, 179, 153, 128, 106,  88,  73,  93,  87,  87,  84,  79,  72,
        68,  61,  58,  57,  59,  58,  57,  57,  58,  56,  56,  56,  56,
        55,  54,  54, 158, 138, 117,  97,  82,  71,  65,  62,  62,  63,
        63,  61,  60,  59,  59,  59,  59,  60,  60,  61,  60,  60,  60,
        60,  61,  60,  61,  60,  60,  61,  62,  63,  63,  63,  62,  62,
        61,  61,  61,  63,  64,  64,  64,  64,  65,  65,  66,  67,  68,
        71,  74,  75,  76,  79,  81,  84,  88,  91,  91,  92,  92,  94,
        98, 100, 102, 105, 106, 104, 104, 102, 100, 101, 103, 104, 105,
       104, 101,  99,  97,  94,  90,  89,  88,  87,  88,  86,  84,  81,
        77,  76,  75,  74,  73,  72,  70,  67,  67,  65,  65,  64,  63,
        64,  63,  61,  60,  61,  62,  61,  61,  60,  60,  60,  58,  58,
        58,  57,  58,  57,  58,  58,  59,  58,  58,  57,  57,  58,  58,
        57,  57,  57,  57,  57,  56,  56,  56,  55,  56,  56,  56,  57,
        57,  56,  57,  56,  55,  56,  56,  56,  56,  55,  55,  55,  54,
        55,  55,  55,  55,  55,  56,  56,  56,  55,  55,  56,  55,  55,
        54,  54,  55,  55,  56,  55,  56,  56,  56,  55,  55,  55,  55,
        55,  55,  55,  55,  56,  56,  56,  56,  55,  54,  55,  56,  56,
        55,  55,  55,  55,  55,  55,  55,  55,  55,  54,  55,  54,  55,
        54,  54,  55,  54,  54,  55,  55,  55,  55,  55,  55,  56,  55,
        55,  55,  55,  55,  55,  55,  55,  55,  55,  55,  55,  54,  54,
        54,  55,  54,  54,  54,  55,  55,  55,  54,  54,  54,  55,  54,
        54,  54,  54,  55,  55,  55,  55,  55,  56,  56,  55,  55,  55,
        55,  54,  54,  54,  55,  55,  54,  54,  54,  54,  55,  55,  55,
        55], dtype=uint8), &#x27;Amp3&#x27;: array([202, 180, 153, 127, 106,  88,  73,  93,  87,  87,  84,  79,  72,
        68,  61,  58,  57,  59,  58,  58,  57,  57,  56,  55,  56,  56,
        54,  53,  53, 155, 133, 112,  93,  79,  69,  65,  62,  61,  62,
        61,  61,  61,  60,  59,  58,  59,  59,  59,  60,  60,  61,  61,
        61,  61,  60,  60,  62,  64,  64,  63,  62,  62,  61,  60,  60,
        60,  60,  60,  61,  61,  62,  62,  63,  63,  64,  65,  67,  69,
        68,  69,  71,  72,  74,  75,  76,  79,  82,  85,  87,  89,  89,
        90,  92,  94,  96,  99,  98,  98,  97,  97,  96, 100, 101, 101,
        98,  98,  98,  97,  93,  91,  89,  87,  87,  87,  85,  85,  83,
        81,  79,  76,  72,  72,  69,  68,  67,  66,  64,  64,  64,  62,
        62,  61,  61,  62,  62,  63,  62,  61,  59,  59,  59,  58,  58,
        58,  57,  57,  57,  57,  58,  60,  60,  58,  57,  58,  57,  58,
        59,  60,  59,  57,  57,  56,  56,  56,  56,  57,  56,  56,  56,
        56,  56,  57,  56,  56,  56,  56,  56,  56,  56,  55,  56,  55,
        56,  56,  57,  56,  56,  56,  56,  55,  55,  55,  55,  55,  56,
        56,  56,  55,  56,  56,  55,  56,  55,  55,  56,  57,  56,  56,
        55,  56,  55,  55,  55,  56,  56,  55,  55,  55,  55,  56,  56,
        56,  56,  56,  56,  56,  56,  55,  55,  56,  55,  55,  55,  55,
        55,  55,  54,  54,  55,  55,  56,  55,  55,  55,  55,  55,  55,
        56,  55,  56,  55,  55,  55,  55,  56,  56,  56,  55,  55,  55,
        55,  55,  56,  55,  55,  55,  55,  54,  55,  55,  55,  56,  55,
        55,  55,  56,  55,  55,  56,  56,  55,  56,  56,  56,  55,  55,
        55,  55,  55,  55,  55,  55,  55,  55,  56,  56,  55,  55,  55,
        55], dtype=uint8)}}</dd><dt><span>inst_make :</span></dt><dd>Nortek</dd><dt><span>inst_model :</span></dt><dd>Vector</dd><dt><span>inst_type :</span></dt><dd>ADV</dd><dt><span>rotate_vars :</span></dt><dd>[&#x27;vel&#x27;]</dd><dt><span>freq :</span></dt><dd>6000</dd><dt><span>SerialNum :</span></dt><dd>VEC 9062</dd><dt><span>Comments :</span></dt><dd>APL-UW vector on Tidal Turbulence Mooring in Admiralty, times PDT</dd><dt><span>fs :</span></dt><dd>32.0</dd><dt><span>coord_sys :</span></dt><dd>inst</dd><dt><span>has_imu :</span></dt><dd>0</dd></dl></div></li></ul></div></div></div>
</div>
</div>
<div class="section" id="QC’ing-Data">
<h2>QC’ing Data<a class="headerlink" href="#QC’ing-Data" title="Permalink to this headline"></a></h2>
<p>ADV velocity data tends to have spikes due to Doppler noise, and the common way to “despike” the data is by using the phase-space algorithm by Goring and Nikora (2002). DOLfYN integrates this function using a 2-step approach: create a logical mask where True corresponds to a spike detection, and then utilize an interpolation function to replace the spikes.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clean the file using the Goring+Nikora method:</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">clean</span><span class="o">.</span><span class="n">GN2002</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">vel</span><span class="p">,</span> <span class="n">npt</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
<span class="c1"># Replace bad datapoints via cubic spline interpolation</span>
<span class="n">ds</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">clean</span><span class="o">.</span><span class="n">clean_fill</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="n">mask</span><span class="p">,</span> <span class="n">npt</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Percent of data containing spikes: </span><span class="si">{0:.2f}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">mask</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>

<span class="c1"># If interpolation isn&#39;t desired:</span>
<span class="n">ds_nan</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds_nan</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;dir&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">),</span> <span class="o">~</span><span class="n">mask</span><span class="p">)</span>
<span class="n">ds_nan</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_nan</span><span class="o">.</span><span class="n">vel</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds_nan</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Percent of data containing spikes: 0.73%
</pre></div></div>
</div>
</div>
<div class="section" id="Coordinate-Rotations">
<h2>Coordinate Rotations<a class="headerlink" href="#Coordinate-Rotations" title="Permalink to this headline"></a></h2>
<p>Now that the data has been cleaned, the next step is to rotate the velocity data into true East, North, Up (ENU) coordinates.</p>
<p>ADVs use an internal compass or magnetometer to determine magnetic ENU directions. The <code class="docutils literal notranslate"><span class="pre">set_declination</span></code> function takes the user supplied magnetic declination (which can be looked up online for specific coordinates) and adjusts the orientation matrix saved within the Dataset. (Note: the “heading” variable will not change).</p>
<p>Instruments save vector data in the coordinate system specified in the deployment configuration file. To make the data useful, it must be rotated through these coordinate systems (“beam”&lt;-&gt;“inst”&lt;-&gt;“earth”&lt;-&gt;“principal”), done through the <code class="docutils literal notranslate"><span class="pre">rotate2</span></code> function. If the “earth” (ENU) coordinate system is specified, DOLfYN will automatically rotate the dataset through the necessary coordinate systems to get there.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First set the magnetic declination</span>
<span class="n">ds_mag</span> <span class="o">=</span> <span class="n">dlfn</span><span class="o">.</span><span class="n">set_declination</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c1"># declination points 10 degrees East</span>

<span class="c1"># Rotate that data from the instrument to earth frame (ENU):</span>
<span class="n">ds_earth</span> <span class="o">=</span> <span class="n">dlfn</span><span class="o">.</span><span class="n">rotate2</span><span class="p">(</span><span class="n">ds_mag</span><span class="p">,</span> <span class="s1">&#39;earth&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Once in the true ENU frame of reference, we can calculate the principal flow direction for the velocity data and rotate it into the principal frame of reference (streamwise, cross-stream, vertical). Principal flow directions are aligned with and orthogonal to the flow streamlines at the measurement location.</p>
<p>First, the principal flow direction must be calculated through <code class="docutils literal notranslate"><span class="pre">calc_principal_heading</span></code>. As a standard for DOLfYN functions, those that begin with “calc_*” require the velocity data for input. This function is different from others in DOLfYN in that it requires place the output in an attribute called “principal_heading”, as shown below.</p>
<p>Again we use <code class="docutils literal notranslate"><span class="pre">rotate2</span></code> to change coordinate systems.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_earth</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;principal_heading&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dlfn</span><span class="o">.</span><span class="n">calc_principal_heading</span><span class="p">(</span><span class="n">ds_earth</span><span class="o">.</span><span class="n">vel</span><span class="p">)</span>
<span class="n">ds_stream</span> <span class="o">=</span> <span class="n">dlfn</span><span class="o">.</span><span class="n">rotate2</span><span class="p">(</span><span class="n">ds_earth</span><span class="p">,</span> <span class="s1">&#39;principal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Averaging-Data">
<h2>Averaging Data<a class="headerlink" href="#Averaging-Data" title="Permalink to this headline"></a></h2>
<p>The next step in ADV analysis is to average the velocity data into time bins (ensembles) and calculate turbulence statistics. There are a couple ways to do this, and both of these methods use the same variable inputs and return identical datasets.</p>
<ol class="arabic simple">
<li><p>Define an averaging object, create a binned dataset and calculate basic turbulence statistics. This is done by initiating an object from the <code class="docutils literal notranslate"><span class="pre">ADVBinner</span></code> class, and subsequently supplying that object with our dataset.</p></li>
<li><p>Alternatively, the functional version of ADVBinner, <code class="docutils literal notranslate"><span class="pre">calc_turbulence</span></code>.</p></li>
</ol>
<p>Function inputs shown here are the dataset itself; “n_bin”, the number of elements in each bin; “fs”, the ADV’s sampling frequency in Hz; “n_fft”, optional, the number of elements per FFT for spectral analysis; “freq_units”, optional, either in Hz or rad/s, of the calculated spectral frequency vector.</p>
<p>All of the variables in the returned dataset have been bin-averaged, where each average is computed using the number of elements specified in “n_bins”. Additional variables in this dataset include the turbulent kinetic energy (TKE) vector (“ds_binned.tke_vec”), the Reynold’s stresses (“ds_binned.stress”), and the power spectral densities (“ds_binned.psd”), calculated for each bin.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">binner</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">ADVBinner</span><span class="p">(</span><span class="n">n_bin</span><span class="o">=</span><span class="mi">9600</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">ds_stream</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="mi">2048</span><span class="p">)</span>
<span class="n">ds_binned</span> <span class="o">=</span> <span class="n">binner</span><span class="p">(</span><span class="n">ds_stream</span><span class="p">,</span> <span class="n">freq_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">)</span>

<span class="n">ds_binned</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">calc_turbulence</span><span class="p">(</span><span class="n">ds_stream</span><span class="p">,</span> <span class="n">n_bin</span><span class="o">=</span><span class="mi">9600</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="n">ds_stream</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="n">n_fft</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span> <span class="n">freq_units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The benefit to using <code class="docutils literal notranslate"><span class="pre">ADVBinner</span></code> is that one has access to all of the velocity and turbulence analysis functions that DOLfYN contains. If basic analysis will suffice, the <code class="docutils literal notranslate"><span class="pre">calc_turbulence</span></code> function is the most convienent. Either option can still utilize DOLfYN’s shortcuts.</p>
<p>See the <a class="reference external" href="https://mhkit.dolfyn.readthedocs.io/en/latest/apidoc/mhkit.dolfyn.binners.html">DOLfYN API</a> for the full list of functions and shortcuts. A few examples are shown below.</p>
<p>Some things to know: - All functions operate bin-by-bin. - <code class="docutils literal notranslate"><span class="pre">do_*</span></code> functions return a full dataset. The first two inputs are the original dataset and the dataset containing the variables calculated by the function. If an output dataset is not given, it will create one. - <code class="docutils literal notranslate"><span class="pre">calc_*</span></code> functions return a data variable, which can be added to the dataset with a variable of your choosing. If inputs weren’t specified in <code class="docutils literal notranslate"><span class="pre">ADVBinner</span></code>, they can be called here. Most of these functions can take both 3D
and 1D velocity vectors as inputs. - “Shorcuts”, as referred to in DOLfYN, are functions accessible by the xarray accessor <code class="docutils literal notranslate"><span class="pre">velds</span></code>, as shown below. The list of “shorcuts” available through <code class="docutils literal notranslate"><span class="pre">velds</span></code> are listed <a class="reference external" href="https://mhkit.dolfyn.readthedocs.io/en/latest/apidoc/mhkit.dolfyn.shortcuts.html">here</a>. Some shorcut variables require the raw dataset, some an averaged dataset.</p>
<p>For instance, - <code class="docutils literal notranslate"><span class="pre">do_var</span></code> calculates the binned-variance of each variable in the raw dataset, the complementary to <code class="docutils literal notranslate"><span class="pre">do_avg</span></code>. Variables returned by this function contain a “_var” suffix to their name. - <code class="docutils literal notranslate"><span class="pre">calc_csd</span></code> calculates the cross spectral power density between each direction of the supplied DataArray. Note that inputs specified in creating the <code class="docutils literal notranslate"><span class="pre">ADVBinner</span></code> object can be overridden or additionally specified for a particular function call. - <code class="docutils literal notranslate"><span class="pre">velds.I</span></code> is the shortcut for turbulence
intensity. This particular shortcut requires a dataset created by <code class="docutils literal notranslate"><span class="pre">do_avg</span></code>, because it requires bin-averaged data to calculate.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the variance of each variable in the dataset and add to the averaged dataset</span>
<span class="n">ds_binned</span> <span class="o">=</span> <span class="n">binner</span><span class="o">.</span><span class="n">do_var</span><span class="p">(</span><span class="n">ds_stream</span><span class="p">,</span> <span class="n">out_ds</span><span class="o">=</span><span class="n">ds_binned</span><span class="p">)</span>

<span class="c1"># Calculate the cross power spectral density</span>
<span class="n">ds_binned</span><span class="p">[</span><span class="s1">&#39;csd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binner</span><span class="o">.</span><span class="n">calc_csd</span><span class="p">(</span><span class="n">ds_stream</span><span class="p">[</span><span class="s1">&#39;vel&#39;</span><span class="p">],</span> <span class="n">freq_units</span><span class="o">=</span><span class="s1">&#39;Hz&#39;</span><span class="p">,</span> <span class="n">n_fft_coh</span><span class="o">=</span><span class="mi">2048</span><span class="p">)</span>

<span class="c1"># Calculated the turbulence intensity (requires a binned dataset)</span>
<span class="n">ds_binned</span><span class="p">[</span><span class="s1">&#39;TI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_binned</span><span class="o">.</span><span class="n">velds</span><span class="o">.</span><span class="n">I</span>
</pre></div>
</div>
</div>
<p>Plotting can be taken care of through matplotlib. As an example, the mean spectrum in the streamwise direction is plotted here. This spectrum shows the mean energy density in the flow at a particular flow frequency.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">ds_binned</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="n">ds_binned</span><span class="o">.</span><span class="n">psd</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">S</span><span class="o">=</span><span class="s1">&#39;Sxx&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Frequency [Hz]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy Density $\mathrm{[m^2/s^s/Hz]}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Streamwise Direction&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Streamwise Direction&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/adv_example_21_1.png" src="_images/adv_example_21_1.png" />
</div>
</div>
</div>
<div class="section" id="Saving-and-Loading-DOLfYN-datasets">
<h2>Saving and Loading DOLfYN datasets<a class="headerlink" href="#Saving-and-Loading-DOLfYN-datasets" title="Permalink to this headline"></a></h2>
<p>Datasets can be saved and reloaded using the <code class="docutils literal notranslate"><span class="pre">save</span></code> and <code class="docutils literal notranslate"><span class="pre">load</span></code> functions. Xarray is saved natively in netCDF format, hence the “.nc” extension.</p>
<p>Note: DOLfYN datasets cannot be saved using xarray’s native <code class="docutils literal notranslate"><span class="pre">ds.to_netcdf</span></code>; however, DOLfYN datasets can be opened using <code class="docutils literal notranslate"><span class="pre">xarray.open_dataset</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Uncomment these lines to save and load to your current working directory</span>
<span class="c1">#dlfn.save(ds, &#39;your_data.nc&#39;)</span>
<span class="c1">#ds_saved = dlfn.load(&#39;your_data.nc&#39;)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, National Renewable Energy Laboratory, Pacific Northwest National Laboratory, and Sandia National Laboratories.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-164358105-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-164358105-1', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>